var I0=Object.defineProperty;var Jf=(e,n)=>{for(var r in n)I0(e,r,{get:n[r],enumerable:!0,configurable:!0,set:(f)=>n[r]=()=>f})};function qf(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function xn(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function If(e){if(typeof e!=="function"||typeof e.create!=="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");qf(e.outputLen),qf(e.blockLen)}function en(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function Qf(e,n){xn(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var Mn=typeof globalThis==="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function E0(e){if(typeof e!=="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function $n(e){if(typeof e==="string")e=E0(e);if(!Ef(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Gf(...e){const n=new Uint8Array(e.reduce((f,c)=>f+c.length,0));let r=0;return e.forEach((f)=>{if(!Ef(f))throw new Error("Uint8Array expected");n.set(f,r),r+=f.length}),n}function Mf(e){const n=(f)=>e().update($n(f)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function on(e=32){if(Mn&&typeof Mn.getRandomValues==="function")return Mn.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Ef=(e)=>e instanceof Uint8Array;var zn=(e)=>new DataView(e.buffer,e.byteOffset,e.byteLength),de=(e,n)=>e<<32-n|e>>>n,Q0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Q0)throw new Error("Non little-endian hardware is not supported");class gn{clone(){return this._cloneInto()}}var j8={}.toString;function G0(e,n,r,f){if(typeof e.setBigUint64==="function")return e.setBigUint64(n,r,f);const c=BigInt(32),l=BigInt(4294967295),w=Number(r>>c&l),$=Number(r&l),g=f?4:0,d=f?0:4;e.setUint32(n+g,w,f),e.setUint32(n+d,$,f)}class pn extends gn{constructor(e,n,r,f){super();this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=f,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=zn(this.buffer)}update(e){en(this);const{view:n,buffer:r,blockLen:f}=this;e=$n(e);const c=e.length;for(let l=0;l<c;){const w=Math.min(f-this.pos,c-l);if(w===f){const $=zn(e);for(;f<=c-l;l+=f)this.process($,l);continue}if(r.set(e.subarray(l,l+w),this.pos),this.pos+=w,l+=w,this.pos===f)this.process(n,0),this.pos=0}return this.length+=e.length,this.roundClean(),this}digestInto(e){en(this),Qf(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:f,isLE:c}=this;let{pos:l}=this;if(n[l++]=128,this.buffer.subarray(l).fill(0),this.padOffset>f-l)this.process(r,0),l=0;for(let v=l;v<f;v++)n[v]=0;G0(r,f-8,BigInt(this.length*8),c),this.process(r,0);const w=zn(e),$=this.outputLen;if($%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=$/4,d=this.get();if(g>d.length)throw new Error("_sha2: outputLen bigger than state");for(let v=0;v<g;v++)w.setUint32(4*v,d[v],c)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:f,finished:c,destroyed:l,pos:w}=this;if(e.length=f,e.pos=w,e.finished=c,e.destroyed=l,f%n)e.buffer.set(r);return e}}var M0=(e,n,r)=>e&n^~e&r,z0=(e,n,r)=>e&n^e&r^n&r,o0=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ve=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),De=new Uint32Array(64);class zf extends pn{constructor(){super(64,32,8,!1);this.A=Ve[0]|0,this.B=Ve[1]|0,this.C=Ve[2]|0,this.D=Ve[3]|0,this.E=Ve[4]|0,this.F=Ve[5]|0,this.G=Ve[6]|0,this.H=Ve[7]|0}get(){const{A:e,B:n,C:r,D:f,E:c,F:l,G:w,H:$}=this;return[e,n,r,f,c,l,w,$]}set(e,n,r,f,c,l,w,$){this.A=e|0,this.B=n|0,this.C=r|0,this.D=f|0,this.E=c|0,this.F=l|0,this.G=w|0,this.H=$|0}process(e,n){for(let v=0;v<16;v++,n+=4)De[v]=e.getUint32(n,!1);for(let v=16;v<64;v++){const J=De[v-15],I=De[v-2],E=de(J,7)^de(J,18)^J>>>3,i=de(I,17)^de(I,19)^I>>>10;De[v]=i+De[v-7]+E+De[v-16]|0}let{A:r,B:f,C:c,D:l,E:w,F:$,G:g,H:d}=this;for(let v=0;v<64;v++){const J=de(w,6)^de(w,11)^de(w,25),I=d+J+M0(w,$,g)+o0[v]+De[v]|0,i=(de(r,2)^de(r,13)^de(r,22))+z0(r,f,c)|0;d=g,g=$,$=w,w=l+I|0,l=c,c=f,f=r,r=I+i|0}r=r+this.A|0,f=f+this.B|0,c=c+this.C|0,l=l+this.D|0,w=w+this.E|0,$=$+this.F|0,g=g+this.G|0,d=d+this.H|0,this.set(r,f,c,l,w,$,g,d)}roundClean(){De.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}var Un=Mf(()=>new zf);var fr={};Jf(fr,{validateObject:()=>He,utf8ToBytes:()=>W0,numberToVarBytesBE:()=>N0,numberToHexUnpadded:()=>Xf,numberToBytesLE:()=>Wn,numberToBytesBE:()=>ie,hexToNumber:()=>nr,hexToBytes:()=>ye,equalBytes:()=>T0,ensureBytes:()=>h,createHmacDrbg:()=>rr,concatBytes:()=>Te,bytesToNumberLE:()=>Tn,bytesToNumberBE:()=>s,bytesToHex:()=>ae,bitSet:()=>Z0,bitMask:()=>vn,bitLen:()=>Y0,bitGet:()=>A0});function ae(e){if(!Nn(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=X0[e[r]];return n}function Xf(e){const n=e.toString(16);return n.length&1?`0${n}`:n}function nr(e){if(typeof e!=="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function ye(e){if(typeof e!=="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let f=0;f<r.length;f++){const c=f*2,l=e.slice(c,c+2),w=Number.parseInt(l,16);if(Number.isNaN(w)||w<0)throw new Error("Invalid byte sequence");r[f]=w}return r}function s(e){return nr(ae(e))}function Tn(e){if(!Nn(e))throw new Error("Uint8Array expected");return nr(ae(Uint8Array.from(e).reverse()))}function ie(e,n){return ye(e.toString(16).padStart(n*2,"0"))}function Wn(e,n){return ie(e,n).reverse()}function N0(e){return ye(Xf(e))}function h(e,n,r){let f;if(typeof n==="string")try{f=ye(n)}catch(l){throw new Error(`${e} must be valid hex string, got "${n}". Cause: ${l}`)}else if(Nn(n))f=Uint8Array.from(n);else throw new Error(`${e} must be hex string or Uint8Array`);const c=f.length;if(typeof r==="number"&&c!==r)throw new Error(`${e} expected ${r} bytes, got ${c}`);return f}function Te(...e){const n=new Uint8Array(e.reduce((f,c)=>f+c.length,0));let r=0;return e.forEach((f)=>{if(!Nn(f))throw new Error("Uint8Array expected");n.set(f,r),r+=f.length}),n}function T0(e,n){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}function W0(e){if(typeof e!=="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Y0(e){let n;for(n=0;e>Uf;e>>=Xn,n+=1);return n}function A0(e,n){return e>>BigInt(n)&Xn}function rr(e,n,r){if(typeof e!=="number"||e<2)throw new Error("hashLen must be a number");if(typeof n!=="number"||n<2)throw new Error("qByteLen must be a number");if(typeof r!=="function")throw new Error("hmacFn must be a function");let f=er(e),c=er(e),l=0;const w=()=>{f.fill(1),c.fill(0),l=0},$=(...J)=>r(c,f,...J),g=(J=er())=>{if(c=$(of([0]),J),f=$(),J.length===0)return;c=$(of([1]),J),f=$()},d=()=>{if(l++>=1000)throw new Error("drbg: tried 1000 values");let J=0;const I=[];while(J<n){f=$();const E=f.slice();I.push(E),J+=f.length}return Te(...I)};return(J,I)=>{w(),g(J);let E=void 0;while(!(E=I(d())))g();return w(),E}}function He(e,n,r={}){const f=(c,l,w)=>{const $=O0[l];if(typeof $!=="function")throw new Error(`Invalid validator "${l}", expected function`);const g=e[c];if(w&&g===void 0)return;if(!$(g,e))throw new Error(`Invalid param ${String(c)}=${g} (${typeof g}), expected ${l}`)};for(let[c,l]of Object.entries(n))f(c,l,!1);for(let[c,l]of Object.entries(r))f(c,l,!0);return e}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Uf=BigInt(0),Xn=BigInt(1),U0=BigInt(2),Nn=(e)=>e instanceof Uint8Array,X0=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0")),Z0=(e,n,r)=>{return e|(r?Xn:Uf)<<BigInt(n)},vn=(e)=>(U0<<BigInt(e-1))-Xn,er=(e)=>new Uint8Array(e),of=(e)=>Uint8Array.from(e),O0={bigint:(e)=>typeof e==="bigint",function:(e)=>typeof e==="function",boolean:(e)=>typeof e==="boolean",string:(e)=>typeof e==="string",stringOrUint8Array:(e)=>typeof e==="string"||e instanceof Uint8Array,isSafeInteger:(e)=>Number.isSafeInteger(e),array:(e)=>Array.isArray(e),field:(e,n)=>n.Fp.isValid(e),hash:(e)=>typeof e==="function"&&Number.isSafeInteger(e.outputLen)};function b(e,n){const r=e%n;return r>=F?r:n+r}function H0(e,n,r){if(r<=F||n<F)throw new Error("Expected power/modulo > 0");if(r===_)return F;let f=_;while(n>F){if(n&_)f=f*e%r;e=e*e%r,n>>=_}return f}function ce(e,n,r){let f=e;while(n-- >F)f*=f,f%=r;return f}function Yn(e,n){if(e===F||n<=F)throw new Error(`invert: expected positive integers, got n=${e} mod=${n}`);let r=b(e,n),f=n,c=F,l=_,w=_,$=F;while(r!==F){const d=f/r,v=f%r,J=c-w*d,I=l-$*d;f=r,r=v,c=w,l=$,w=J,$=I}if(f!==_)throw new Error("invert: does not exist");return b(c,n)}function S0(e){const n=(e-_)/he;let r,f,c;for(r=e-_,f=0;r%he===F;r/=he,f++);for(c=he;c<e&&H0(c,n,e)!==e-_;c++);if(f===1){const w=(e+_)/cr;return function $(g,d){const v=g.pow(d,w);if(!g.eql(g.sqr(v),d))throw new Error("Cannot find square root");return v}}const l=(r+_)/he;return function w($,g){if($.pow(g,n)===$.neg($.ONE))throw new Error("Cannot find square root");let d=f,v=$.pow($.mul($.ONE,c),r),J=$.pow(g,l),I=$.pow(g,r);while(!$.eql(I,$.ONE)){if($.eql(I,$.ZERO))return $.ZERO;let E=1;for(let q=$.sqr(I);E<d;E++){if($.eql(q,$.ONE))break;q=$.sqr(q)}const i=$.pow(v,_<<BigInt(d-E-1));v=$.sqr(i),J=$.mul(J,i),I=$.mul(I,v),d=E}return J}}function t0(e){if(e%cr===R0){const n=(e+_)/cr;return function r(f,c){const l=f.pow(c,n);if(!f.eql(f.sqr(l),c))throw new Error("Cannot find square root");return l}}if(e%Tf===Nf){const n=(e-Nf)/Tf;return function r(f,c){const l=f.mul(c,he),w=f.pow(l,n),$=f.mul(c,w),g=f.mul(f.mul($,he),w),d=f.mul($,f.sub(g,f.ONE));if(!f.eql(f.sqr(d),c))throw new Error("Cannot find square root");return d}}if(e%D0===V0);return S0(e)}function lr(e){const n={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=j0.reduce((f,c)=>{return f[c]="function",f},n);return He(e,r)}function u0(e,n,r){if(r<F)throw new Error("Expected power > 0");if(r===F)return e.ONE;if(r===_)return n;let f=e.ONE,c=n;while(r>F){if(r&_)f=e.mul(f,c);c=e.sqr(c),r>>=_}return f}function K0(e,n){const r=new Array(n.length),f=n.reduce((l,w,$)=>{if(e.is0(w))return l;return r[$]=l,e.mul(l,w)},e.ONE),c=e.inv(f);return n.reduceRight((l,w,$)=>{if(e.is0(w))return l;return r[$]=e.mul(l,r[$]),e.mul(l,w)},c),r}function wr(e,n){const r=n!==void 0?n:e.toString(2).length,f=Math.ceil(r/8);return{nBitLength:r,nByteLength:f}}function Wf(e,n,r=!1,f={}){if(e<=F)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:c,nByteLength:l}=wr(e,n);if(l>2048)throw new Error("Field lengths over 2048 bytes are not supported");const w=t0(e),$=Object.freeze({ORDER:e,BITS:c,BYTES:l,MASK:vn(c),ZERO:F,ONE:_,create:(g)=>b(g,e),isValid:(g)=>{if(typeof g!=="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof g}`);return F<=g&&g<e},is0:(g)=>g===F,isOdd:(g)=>(g&_)===_,neg:(g)=>b(-g,e),eql:(g,d)=>g===d,sqr:(g)=>b(g*g,e),add:(g,d)=>b(g+d,e),sub:(g,d)=>b(g-d,e),mul:(g,d)=>b(g*d,e),pow:(g,d)=>u0($,g,d),div:(g,d)=>b(g*Yn(d,e),e),sqrN:(g)=>g*g,addN:(g,d)=>g+d,subN:(g,d)=>g-d,mulN:(g,d)=>g*d,inv:(g)=>Yn(g,e),sqrt:f.sqrt||((g)=>w($,g)),invertBatch:(g)=>K0($,g),cmov:(g,d,v)=>v?d:g,toBytes:(g)=>r?Wn(g,l):ie(g,l),fromBytes:(g)=>{if(g.length!==l)throw new Error(`Fp.fromBytes: expected ${l}, got ${g.length}`);return r?Tn(g):s(g)}});return Object.freeze($)}function Yf(e){if(typeof e!=="bigint")throw new Error("field order must be bigint");const n=e.toString(2).length;return Math.ceil(n/8)}function $r(e){const n=Yf(e);return n+Math.ceil(n/2)}function Af(e,n,r=!1){const f=e.length,c=Yf(n),l=$r(n);if(f<16||f<l||f>1024)throw new Error(`expected ${l}-1024 bytes of input, got ${f}`);const w=r?s(e):Tn(e),$=b(w,n-_)+_;return r?Wn($,c):ie($,c)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var F=BigInt(0),_=BigInt(1),he=BigInt(2),R0=BigInt(3),cr=BigInt(4),Nf=BigInt(5),Tf=BigInt(8),V0=BigInt(9),D0=BigInt(16);var j0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Zf(e,n){const r=(c,l)=>{const w=l.negate();return c?w:l},f=(c)=>{const l=Math.ceil(n/c)+1,w=2**(c-1);return{windows:l,windowSize:w}};return{constTimeNegate:r,unsafeLadder(c,l){let w=e.ZERO,$=c;while(l>C0){if(l&gr)w=w.add($);$=$.double(),l>>=gr}return w},precomputeWindow(c,l){const{windows:w,windowSize:$}=f(l),g=[];let d=c,v=d;for(let J=0;J<w;J++){v=d,g.push(v);for(let I=1;I<$;I++)v=v.add(d),g.push(v);d=v.double()}return g},wNAF(c,l,w){const{windows:$,windowSize:g}=f(c);let{ZERO:d,BASE:v}=e;const J=BigInt(2**c-1),I=2**c,E=BigInt(c);for(let i=0;i<$;i++){const q=i*g;let Q=Number(w&J);if(w>>=E,Q>g)Q-=I,w+=gr;const G=q,M=q+Math.abs(Q)-1,U=i%2!==0,X=Q<0;if(Q===0)v=v.add(r(U,l[G]));else d=d.add(r(X,l[M]))}return{p:d,f:v}},wNAFCached(c,l,w,$){const g=c._WINDOW_SIZE||1;let d=l.get(c);if(!d){if(d=this.precomputeWindow(c,g),g!==1)l.set(c,$(d))}return this.wNAF(g,d,w)}}}function vr(e){return lr(e.Fp),He(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...wr(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var C0=BigInt(0),gr=BigInt(1);function B0(e){const n=vr(e);He(n,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:f,a:c}=n;if(r){if(!f.eql(c,f.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!=="object"||typeof r.beta!=="bigint"||typeof r.splitScalar!=="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...n})}function _0(e){const n=B0(e),{Fp:r}=n,f=n.toBytes||((i,q,Q)=>{const G=q.toAffine();return Te(Uint8Array.from([4]),r.toBytes(G.x),r.toBytes(G.y))}),c=n.fromBytes||((i)=>{const q=i.subarray(1),Q=r.fromBytes(q.subarray(0,r.BYTES)),G=r.fromBytes(q.subarray(r.BYTES,2*r.BYTES));return{x:Q,y:G}});function l(i){const{a:q,b:Q}=n,G=r.sqr(i),M=r.mul(G,i);return r.add(r.add(M,r.mul(i,q)),Q)}if(!r.eql(r.sqr(n.Gy),l(n.Gx)))throw new Error("bad generator point: equation left != right");function w(i){return typeof i==="bigint"&&We<i&&i<n.n}function $(i){if(!w(i))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function g(i){const{allowedPrivateKeyLengths:q,nByteLength:Q,wrapPrivateKey:G,n:M}=n;if(q&&typeof i!=="bigint"){if(i instanceof Uint8Array)i=ae(i);if(typeof i!=="string"||!q.includes(i.length))throw new Error("Invalid key");i=i.padStart(Q*2,"0")}let U;try{U=typeof i==="bigint"?i:s(h("private key",i,Q))}catch(X){throw new Error(`private key must be ${Q} bytes, hex or bigint, not ${typeof i}`)}if(G)U=b(U,M);return $(U),U}const d=new Map;function v(i){if(!(i instanceof J))throw new Error("ProjectivePoint expected")}class J{constructor(i,q,Q){if(this.px=i,this.py=q,this.pz=Q,i==null||!r.isValid(i))throw new Error("x required");if(q==null||!r.isValid(q))throw new Error("y required");if(Q==null||!r.isValid(Q))throw new Error("z required")}static fromAffine(i){const{x:q,y:Q}=i||{};if(!i||!r.isValid(q)||!r.isValid(Q))throw new Error("invalid affine point");if(i instanceof J)throw new Error("projective point not allowed");const G=(M)=>r.eql(M,r.ZERO);if(G(q)&&G(Q))return J.ZERO;return new J(q,Q,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(i){const q=r.invertBatch(i.map((Q)=>Q.pz));return i.map((Q,G)=>Q.toAffine(q[G])).map(J.fromAffine)}static fromHex(i){const q=J.fromAffine(c(h("pointHex",i)));return q.assertValidity(),q}static fromPrivateKey(i){return J.BASE.multiply(g(i))}_setWindowSize(i){this._WINDOW_SIZE=i,d.delete(this)}assertValidity(){if(this.is0()){if(n.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:i,y:q}=this.toAffine();if(!r.isValid(i)||!r.isValid(q))throw new Error("bad point: x or y not FE");const Q=r.sqr(q),G=l(i);if(!r.eql(Q,G))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:i}=this.toAffine();if(r.isOdd)return!r.isOdd(i);throw new Error("Field doesn't support isOdd")}equals(i){v(i);const{px:q,py:Q,pz:G}=this,{px:M,py:U,pz:X}=i,N=r.eql(r.mul(q,X),r.mul(M,G)),W=r.eql(r.mul(Q,X),r.mul(U,G));return N&&W}negate(){return new J(this.px,r.neg(this.py),this.pz)}double(){const{a:i,b:q}=n,Q=r.mul(q,Of),{px:G,py:M,pz:U}=this;let{ZERO:X,ZERO:N,ZERO:W}=r,Y=r.mul(G,G),D=r.mul(M,M),R=r.mul(U,U),O=r.mul(G,M);return O=r.add(O,O),W=r.mul(G,U),W=r.add(W,W),X=r.mul(i,W),N=r.mul(Q,R),N=r.add(X,N),X=r.sub(D,N),N=r.add(D,N),N=r.mul(X,N),X=r.mul(O,X),W=r.mul(Q,W),R=r.mul(i,R),O=r.sub(Y,R),O=r.mul(i,O),O=r.add(O,W),W=r.add(Y,Y),Y=r.add(W,Y),Y=r.add(Y,R),Y=r.mul(Y,O),N=r.add(N,Y),R=r.mul(M,U),R=r.add(R,R),Y=r.mul(R,O),X=r.sub(X,Y),W=r.mul(R,D),W=r.add(W,W),W=r.add(W,W),new J(X,N,W)}add(i){v(i);const{px:q,py:Q,pz:G}=this,{px:M,py:U,pz:X}=i;let{ZERO:N,ZERO:W,ZERO:Y}=r;const D=n.a,R=r.mul(n.b,Of);let O=r.mul(q,M),t=r.mul(Q,U),j=r.mul(G,X),u=r.add(q,Q),H=r.add(M,U);u=r.mul(u,H),H=r.add(O,t),u=r.sub(u,H),H=r.add(q,G);let z=r.add(M,X);return H=r.mul(H,z),z=r.add(O,j),H=r.sub(H,z),z=r.add(Q,G),N=r.add(U,X),z=r.mul(z,N),N=r.add(t,j),z=r.sub(z,N),Y=r.mul(D,H),N=r.mul(R,j),Y=r.add(N,Y),N=r.sub(t,Y),Y=r.add(t,Y),W=r.mul(N,Y),t=r.add(O,O),t=r.add(t,O),j=r.mul(D,j),H=r.mul(R,H),t=r.add(t,j),j=r.sub(O,j),j=r.mul(D,j),H=r.add(H,j),O=r.mul(t,H),W=r.add(W,O),O=r.mul(z,H),N=r.mul(u,N),N=r.sub(N,O),O=r.mul(u,t),Y=r.mul(z,Y),Y=r.add(Y,O),new J(N,W,Y)}subtract(i){return this.add(i.negate())}is0(){return this.equals(J.ZERO)}wNAF(i){return E.wNAFCached(this,d,i,(q)=>{const Q=r.invertBatch(q.map((G)=>G.pz));return q.map((G,M)=>G.toAffine(Q[M])).map(J.fromAffine)})}multiplyUnsafe(i){const q=J.ZERO;if(i===We)return q;if($(i),i===we)return this;const{endo:Q}=n;if(!Q)return E.unsafeLadder(this,i);let{k1neg:G,k1:M,k2neg:U,k2:X}=Q.splitScalar(i),N=q,W=q,Y=this;while(M>We||X>We){if(M&we)N=N.add(Y);if(X&we)W=W.add(Y);Y=Y.double(),M>>=we,X>>=we}if(G)N=N.negate();if(U)W=W.negate();return W=new J(r.mul(W.px,Q.beta),W.py,W.pz),N.add(W)}multiply(i){$(i);let q=i,Q,G;const{endo:M}=n;if(M){const{k1neg:U,k1:X,k2neg:N,k2:W}=M.splitScalar(q);let{p:Y,f:D}=this.wNAF(X),{p:R,f:O}=this.wNAF(W);Y=E.constTimeNegate(U,Y),R=E.constTimeNegate(N,R),R=new J(r.mul(R.px,M.beta),R.py,R.pz),Q=Y.add(R),G=D.add(O)}else{const{p:U,f:X}=this.wNAF(q);Q=U,G=X}return J.normalizeZ([Q,G])[0]}multiplyAndAddUnsafe(i,q,Q){const G=J.BASE,M=(X,N)=>N===We||N===we||!X.equals(G)?X.multiplyUnsafe(N):X.multiply(N),U=M(this,q).add(M(i,Q));return U.is0()?void 0:U}toAffine(i){const{px:q,py:Q,pz:G}=this,M=this.is0();if(i==null)i=M?r.ONE:r.inv(G);const U=r.mul(q,i),X=r.mul(Q,i),N=r.mul(G,i);if(M)return{x:r.ZERO,y:r.ZERO};if(!r.eql(N,r.ONE))throw new Error("invZ was invalid");return{x:U,y:X}}isTorsionFree(){const{h:i,isTorsionFree:q}=n;if(i===we)return!0;if(q)return q(J,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:i,clearCofactor:q}=n;if(i===we)return this;if(q)return q(J,this);return this.multiplyUnsafe(n.h)}toRawBytes(i=!0){return this.assertValidity(),f(J,this,i)}toHex(i=!0){return ae(this.toRawBytes(i))}}J.BASE=new J(n.Gx,n.Gy,r.ONE),J.ZERO=new J(r.ZERO,r.ONE,r.ZERO);const I=n.nBitLength,E=Zf(J,n.endo?Math.ceil(I/2):I);return{CURVE:n,ProjectivePoint:J,normPrivateKeyToScalar:g,weierstrassEquation:l,isWithinCurveOrder:w}}function a0(e){const n=vr(e);return He(n,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...n})}function Rf(e){const n=a0(e),{Fp:r,n:f}=n,c=r.BYTES+1,l=2*r.BYTES+1;function w(z){return We<z&&z<r.ORDER}function $(z){return b(z,f)}function g(z){return Yn(z,f)}const{ProjectivePoint:d,normPrivateKeyToScalar:v,weierstrassEquation:J,isWithinCurveOrder:I}=_0({...n,toBytes(z,T,Z){const o=T.toAffine(),V=r.toBytes(o.x),S=Te;if(Z)return S(Uint8Array.from([T.hasEvenY()?2:3]),V);else return S(Uint8Array.from([4]),V,r.toBytes(o.y))},fromBytes(z){const T=z.length,Z=z[0],o=z.subarray(1);if(T===c&&(Z===2||Z===3)){const V=s(o);if(!w(V))throw new Error("Point is not on curve");const S=J(V);let K=r.sqrt(S);const P=(K&we)===we;if((Z&1)===1!==P)K=r.neg(K);return{x:V,y:K}}else if(T===l&&Z===4){const V=r.fromBytes(o.subarray(0,r.BYTES)),S=r.fromBytes(o.subarray(r.BYTES,2*r.BYTES));return{x:V,y:S}}else throw new Error(`Point of length ${T} was invalid. Expected ${c} compressed bytes or ${l} uncompressed bytes`)}}),E=(z)=>ae(ie(z,n.nByteLength));function i(z){const T=f>>we;return z>T}function q(z){return i(z)?$(-z):z}const Q=(z,T,Z)=>s(z.slice(T,Z));class G{constructor(z,T,Z){this.r=z,this.s=T,this.recovery=Z,this.assertValidity()}static fromCompact(z){const T=n.nByteLength;return z=h("compactSignature",z,T*2),new G(Q(z,0,T),Q(z,T,2*T))}static fromDER(z){const{r:T,s:Z}=be.toSig(h("DER",z));return new G(T,Z)}assertValidity(){if(!I(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!I(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(z){return new G(this.r,this.s,z)}recoverPublicKey(z){const{r:T,s:Z,recovery:o}=this,V=Y(h("msgHash",z));if(o==null||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const S=o===2||o===3?T+n.n:T;if(S>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const K=(o&1)===0?"02":"03",P=d.fromHex(K+E(S)),y=g(S),ee=$(-V*y),fe=$(Z*y),ne=d.BASE.multiplyAndAddUnsafe(P,ee,fe);if(!ne)throw new Error("point at infinify");return ne.assertValidity(),ne}hasHighS(){return i(this.s)}normalizeS(){return this.hasHighS()?new G(this.r,$(-this.s),this.recovery):this}toDERRawBytes(){return ye(this.toDERHex())}toDERHex(){return be.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ye(this.toCompactHex())}toCompactHex(){return E(this.r)+E(this.s)}}const M={isValidPrivateKey(z){try{return v(z),!0}catch(T){return!1}},normPrivateKeyToScalar:v,randomPrivateKey:()=>{const z=$r(n.n);return Af(n.randomBytes(z),n.n)},precompute(z=8,T=d.BASE){return T._setWindowSize(z),T.multiply(BigInt(3)),T}};function U(z,T=!0){return d.fromPrivateKey(z).toRawBytes(T)}function X(z){const T=z instanceof Uint8Array,Z=typeof z==="string",o=(T||Z)&&z.length;if(T)return o===c||o===l;if(Z)return o===2*c||o===2*l;if(z instanceof d)return!0;return!1}function N(z,T,Z=!0){if(X(z))throw new Error("first arg must be private key");if(!X(T))throw new Error("second arg must be public key");return d.fromHex(T).multiply(v(z)).toRawBytes(Z)}const W=n.bits2int||function(z){const T=s(z),Z=z.length*8-n.nBitLength;return Z>0?T>>BigInt(Z):T},Y=n.bits2int_modN||function(z){return $(W(z))},D=vn(n.nBitLength);function R(z){if(typeof z!=="bigint")throw new Error("bigint expected");if(!(We<=z&&z<D))throw new Error(`bigint expected < 2^${n.nBitLength}`);return ie(z,n.nByteLength)}function O(z,T,Z=t){if(["recovered","canonical"].some((_e)=>(_e in Z)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:V}=n;let{lowS:S,prehash:K,extraEntropy:P}=Z;if(S==null)S=!0;if(z=h("msgHash",z),K)z=h("prehashed msgHash",o(z));const y=Y(z),ee=v(T),fe=[R(ee),R(y)];if(P!=null){const _e=P===!0?V(r.BYTES):P;fe.push(h("extraEntropy",_e))}const ne=Te(...fe),ve=y;function Ee(_e){const xe=W(_e);if(!I(xe))return;const gf=g(xe),Ge=d.BASE.multiply(xe).toAffine(),pe=$(Ge.x);if(pe===We)return;const Gn=$(gf*$(ve+pe*ee));if(Gn===We)return;let vf=(Ge.x===pe?0:2)|Number(Ge.y&we),df=Gn;if(S&&i(Gn))df=q(Gn),vf^=1;return new G(pe,df,vf)}return{seed:ne,k2sig:Ee}}const t={lowS:n.lowS,prehash:!1},j={lowS:n.lowS,prehash:!1};function u(z,T,Z=t){const{seed:o,k2sig:V}=O(z,T,Z),S=n;return rr(S.hash.outputLen,S.nByteLength,S.hmac)(o,V)}d.BASE._setWindowSize(8);function H(z,T,Z,o=j){const V=z;if(T=h("msgHash",T),Z=h("publicKey",Z),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:S,prehash:K}=o;let P=void 0,y;try{if(typeof V==="string"||V instanceof Uint8Array)try{P=G.fromDER(V)}catch(Ge){if(!(Ge instanceof be.Err))throw Ge;P=G.fromCompact(V)}else if(typeof V==="object"&&typeof V.r==="bigint"&&typeof V.s==="bigint"){const{r:Ge,s:pe}=V;P=new G(Ge,pe)}else throw new Error("PARSE");y=d.fromHex(Z)}catch(Ge){if(Ge.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(S&&P.hasHighS())return!1;if(K)T=n.hash(T);const{r:ee,s:fe}=P,ne=Y(T),ve=g(fe),Ee=$(ne*ve),_e=$(ee*ve),xe=d.BASE.multiplyAndAddUnsafe(y,Ee,_e)?.toAffine();if(!xe)return!1;return $(xe.x)===ee}return{CURVE:n,getPublicKey:U,getSharedSecret:N,sign:u,verify:H,ProjectivePoint:d,Signature:G,utils:M}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var{bytesToNumberBE:m0,hexToBytes:L0}=fr,be={Err:class e extends Error{constructor(n=""){super(n)}},_parseInt(e){const{Err:n}=be;if(e.length<2||e[0]!==2)throw new n("Invalid signature integer tag");const r=e[1],f=e.subarray(2,r+2);if(!r||f.length!==r)throw new n("Invalid signature integer: wrong length");if(f[0]&128)throw new n("Invalid signature integer: negative");if(f[0]===0&&!(f[1]&128))throw new n("Invalid signature integer: unnecessary leading zero");return{d:m0(f),l:e.subarray(r+2)}},toSig(e){const{Err:n}=be,r=typeof e==="string"?L0(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let f=r.length;if(f<2||r[0]!=48)throw new n("Invalid signature tag");if(r[1]!==f-2)throw new n("Invalid signature: incorrect length");const{d:c,l}=be._parseInt(r.subarray(2)),{d:w,l:$}=be._parseInt(l);if($.length)throw new n("Invalid signature: left bytes after parsing");return{r:c,s:w}},hexFromSig(e){const n=(d)=>Number.parseInt(d[0],16)&8?"00"+d:d,r=(d)=>{const v=d.toString(16);return v.length&1?`0${v}`:v},f=n(r(e.s)),c=n(r(e.r)),l=f.length/2,w=c.length/2,$=r(l),g=r(w);return`30${r(w+l+4)}02${g}${c}02${$}${f}`}},We=BigInt(0),we=BigInt(1),k8=BigInt(2),Of=BigInt(3),s8=BigInt(4);class dr extends gn{constructor(e,n){super();this.finished=!1,this.destroyed=!1,If(e);const r=$n(n);if(this.iHash=e.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const f=this.blockLen,c=new Uint8Array(f);c.set(r.length>f?e.create().update(r).digest():r);for(let l=0;l<c.length;l++)c[l]^=54;this.iHash.update(c),this.oHash=e.create();for(let l=0;l<c.length;l++)c[l]^=106;this.oHash.update(c),c.fill(0)}update(e){return en(this),this.iHash.update(e),this}digestInto(e){en(this),xn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:f,destroyed:c,blockLen:l,outputLen:w}=this;return e=e,e.finished=f,e.destroyed=c,e.blockLen=l,e.outputLen=w,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var ir=(e,n,r)=>new dr(e,n).update(r).digest();ir.create=(e,n)=>new dr(e,n);function y0(e){return{hash:e,hmac:(n,...r)=>ir(e,n,Gf(...r)),randomBytes:on}}function Vf(e,n){const r=(f)=>Rf({...e,...y0(f)});return Object.freeze({...r(n),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function tf(e){const n=Rn,r=BigInt(3),f=BigInt(6),c=BigInt(11),l=BigInt(22),w=BigInt(23),$=BigInt(44),g=BigInt(88),d=e*e*e%n,v=d*d*e%n,J=ce(v,r,n)*v%n,I=ce(J,r,n)*v%n,E=ce(I,Zn,n)*d%n,i=ce(E,c,n)*E%n,q=ce(i,l,n)*i%n,Q=ce(q,$,n)*q%n,G=ce(Q,g,n)*Q%n,M=ce(G,$,n)*q%n,U=ce(M,r,n)*v%n,X=ce(U,w,n)*i%n,N=ce(X,f,n)*d%n,W=ce(N,Zn,n);if(!qr.eql(qr.sqr(W),e))throw new Error("Cannot find square root");return W}function On(e,...n){let r=Hf[e];if(r===void 0){const f=Un(Uint8Array.from(e,(c)=>c.charCodeAt(0)));r=Te(f,f),Hf[e]=r}return Un(Te(r,...n))}function Qr(e){let n=Se.utils.normPrivateKeyToScalar(e),r=Gr.fromPrivateKey(n);return{scalar:r.hasEvenY()?n:dn(-n),bytes:Er(r)}}function uf(e){if(!jf(e))throw new Error("bad x: need 0 < x < p");const n=Jr(e*e),r=Jr(n*e+BigInt(7));let f=tf(r);if(f%Zn!==Vn)f=Jr(-f);const c=new Gr(e,f,Sf);return c.assertValidity(),c}function Kf(...e){return dn(s(On("BIP0340/challenge",...e)))}function F0(e){return Qr(e).bytes}function k0(e,n,r=on(32)){const f=h("message",e),{bytes:c,scalar:l}=Qr(n),w=h("auxRand",r,32),$=Ir(l^s(On("BIP0340/aux",w))),g=On("BIP0340/nonce",$,c,f),d=dn(s(g));if(d===Vn)throw new Error("sign failed: k is zero");const{bytes:v,scalar:J}=Qr(d),I=Kf(v,c,f),E=new Uint8Array(64);if(E.set(v,0),E.set(Ir(dn(J+I*l)),32),!Pf(E,f,c))throw new Error("sign: Invalid signature produced");return E}function Pf(e,n,r){const f=h("signature",e,64),c=h("message",n),l=h("publicKey",r,32);try{const w=uf(s(l)),$=s(f.subarray(0,32));if(!jf($))return!1;const g=s(f.subarray(32,64));if(!h0(g))return!1;const d=Kf(Ir($),Er(w),c),v=b0(w,g,dn(-d));if(!v||!v.hasEvenY()||v.toAffine().x!==$)return!1;return!0}catch(w){return!1}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Rn=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),An=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Sf=BigInt(1),Zn=BigInt(2),Df=(e,n)=>(e+n/Zn)/n,qr=Wf(Rn,void 0,void 0,{sqrt:tf}),Se=Vf({a:BigInt(0),b:BigInt(7),Fp:qr,n:An,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:(e)=>{const n=An,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),f=-Sf*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),c=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),l=r,w=BigInt("0x100000000000000000000000000000000"),$=Df(l*e,n),g=Df(-f*e,n);let d=b(e-$*r-g*c,n),v=b(-$*f-g*l,n);const J=d>w,I=v>w;if(J)d=n-d;if(I)v=n-v;if(d>w||v>w)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:J,k1:d,k2neg:I,k2:v}}}},Un),Vn=BigInt(0),jf=(e)=>typeof e==="bigint"&&Vn<e&&e<Rn,h0=(e)=>typeof e==="bigint"&&Vn<e&&e<An,Hf={},Er=(e)=>e.toRawBytes(!0).slice(1),Ir=(e)=>ie(e,32),Jr=(e)=>b(e,Rn),dn=(e)=>b(e,An),Gr=Se.ProjectivePoint,b0=(e,n,r)=>Gr.BASE.multiplyAndAddUnsafe(e,n,r),nn=(()=>({getPublicKey:F0,sign:k0,verify:Pf,utils:{randomPrivateKey:Se.utils.randomPrivateKey,lift_x:uf,pointToBytes:Er,numberToBytesBE:ie,bytesToNumberBE:s,taggedHash:On,mod:b}}))();var Dn=typeof globalThis==="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function k(e){if(!Mr(e))throw new Error("Uint8Array expected");let n="";for(let r=0;r<e.length;r++)n+=x0[e[r]];return n}function te(e){if(typeof e!=="string")throw new Error("hex string expected, got "+typeof e);const n=e.length;if(n%2)throw new Error("padded hex string expected, got unpadded hex of length "+n);const r=new Uint8Array(n/2);for(let f=0;f<r.length;f++){const c=f*2,l=e.slice(c,c+2),w=Number.parseInt(l,16);if(Number.isNaN(w)||w<0)throw new Error("Invalid byte sequence");r[f]=w}return r}function p0(e){if(typeof e!=="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function qe(e){if(typeof e==="string")e=p0(e);if(!Mr(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Ye(...e){const n=new Uint8Array(e.reduce((f,c)=>f+c.length,0));let r=0;return e.forEach((f)=>{if(!Mr(f))throw new Error("Uint8Array expected");n.set(f,r),r+=f.length}),n}function Sn(e,n){if(n!==void 0&&(typeof n!=="object"||!el(n)))throw new Error("Options should be object or undefined");return Object.assign(e,n)}function zr(e){const n=(f)=>e().update(qe(f)).digest(),r=e();return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=()=>e(),n}function Fe(e=32){if(Dn&&typeof Dn.getRandomValues==="function")return Dn.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */var Mr=(e)=>e instanceof Uint8Array;var Hn=(e)=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),rn=(e)=>new DataView(e.buffer,e.byteOffset,e.byteLength),Je=(e,n)=>e<<32-n|e>>>n,s0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!s0)throw new Error("Non little-endian hardware is not supported");var x0=Array.from({length:256},(e,n)=>n.toString(16).padStart(2,"0"));class Jn{clone(){return this._cloneInto()}}var el=(e)=>Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object;function Xc(e){if(!Cl(e))return!1;if(typeof e.kind!=="number")return!1;if(typeof e.content!=="string")return!1;if(typeof e.created_at!=="number")return!1;if(typeof e.pubkey!=="string")return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let n=0;n<e.tags.length;n++){let r=e.tags[n];if(!Array.isArray(r))return!1;for(let f=0;f<r.length;f++)if(typeof r[f]==="object")return!1}return!0}function or(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function nl(e){if(typeof e!=="boolean")throw new Error(`Expected boolean, not ${e}`)}function Cf(e,...n){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(n.length>0&&!n.includes(e.length))throw new Error(`Expected Uint8Array of length ${n}, not of length=${e.length}`)}function rl(e){if(typeof e!=="function"||typeof e.create!=="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");or(e.outputLen),or(e.blockLen)}function fl(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function cl(e,n){Cf(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var ll={number:or,bool:nl,bytes:Cf,hash:rl,exists:fl,output:cl},L=ll;function wl(e,n,r,f){if(typeof e.setBigUint64==="function")return e.setBigUint64(n,r,f);const c=BigInt(32),l=BigInt(4294967295),w=Number(r>>c&l),$=Number(r&l),g=f?4:0,d=f?0:4;e.setUint32(n+g,w,f),e.setUint32(n+d,$,f)}class Ur extends Jn{constructor(e,n,r,f){super();this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=f,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=rn(this.buffer)}update(e){L.exists(this);const{view:n,buffer:r,blockLen:f}=this;e=qe(e);const c=e.length;for(let l=0;l<c;){const w=Math.min(f-this.pos,c-l);if(w===f){const $=rn(e);for(;f<=c-l;l+=f)this.process($,l);continue}if(r.set(e.subarray(l,l+w),this.pos),this.pos+=w,l+=w,this.pos===f)this.process(n,0),this.pos=0}return this.length+=e.length,this.roundClean(),this}digestInto(e){L.exists(this),L.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:f,isLE:c}=this;let{pos:l}=this;if(n[l++]=128,this.buffer.subarray(l).fill(0),this.padOffset>f-l)this.process(r,0),l=0;for(let v=l;v<f;v++)n[v]=0;wl(r,f-8,BigInt(this.length*8),c),this.process(r,0);const w=rn(e),$=this.outputLen;if($%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const g=$/4,d=this.get();if(g>d.length)throw new Error("_sha2: outputLen bigger than state");for(let v=0;v<g;v++)w.setUint32(4*v,d[v],c)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:f,finished:c,destroyed:l,pos:w}=this;if(e.length=f,e.pos=w,e.finished=c,e.destroyed=l,f%n)e.buffer.set(r);return e}}var $l=(e,n,r)=>e&n^~e&r,gl=(e,n,r)=>e&n^e&r^n&r,vl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),je=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ue=new Uint32Array(64);class Xr extends Ur{constructor(){super(64,32,8,!1);this.A=je[0]|0,this.B=je[1]|0,this.C=je[2]|0,this.D=je[3]|0,this.E=je[4]|0,this.F=je[5]|0,this.G=je[6]|0,this.H=je[7]|0}get(){const{A:e,B:n,C:r,D:f,E:c,F:l,G:w,H:$}=this;return[e,n,r,f,c,l,w,$]}set(e,n,r,f,c,l,w,$){this.A=e|0,this.B=n|0,this.C=r|0,this.D=f|0,this.E=c|0,this.F=l|0,this.G=w|0,this.H=$|0}process(e,n){for(let v=0;v<16;v++,n+=4)ue[v]=e.getUint32(n,!1);for(let v=16;v<64;v++){const J=ue[v-15],I=ue[v-2],E=Je(J,7)^Je(J,18)^J>>>3,i=Je(I,17)^Je(I,19)^I>>>10;ue[v]=i+ue[v-7]+E+ue[v-16]|0}let{A:r,B:f,C:c,D:l,E:w,F:$,G:g,H:d}=this;for(let v=0;v<64;v++){const J=Je(w,6)^Je(w,11)^Je(w,25),I=d+J+$l(w,$,g)+vl[v]+ue[v]|0,i=(Je(r,2)^Je(r,13)^Je(r,22))+gl(r,f,c)|0;d=g,g=$,$=w,w=l+I|0,l=c,c=f,f=r,r=I+i|0}r=r+this.A|0,f=f+this.B|0,c=c+this.C|0,l=l+this.D|0,w=w+this.E|0,$=$+this.F|0,g=g+this.G|0,d=d+this.H|0,this.set(r,f,c,l,w,$,g,d)}roundClean(){ue.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Bf extends Xr{constructor(){super();this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}var Ie=zr(()=>new Xr),Ug=zr(()=>new Bf);function Nc(e){if(e.indexOf("://")===-1)e="wss://"+e;let n=new URL(e);if(n.pathname=n.pathname.replace(/\/+/g,"/"),n.pathname.endsWith("/"))n.pathname=n.pathname.slice(0,-1);if(n.port==="80"&&n.protocol==="ws:"||n.port==="443"&&n.protocol==="wss:")n.port="";return n.searchParams.sort(),n.hash="",n.toString()}function ml(e,n){const[r,f]=Lr(e,(c)=>{if(n.id===c.id)return 0;if(n.created_at===c.created_at)return-1;return c.created_at-n.created_at});if(!f)e.splice(r,0,n);return e}function Ll(e,n){const[r,f]=Lr(e,(c)=>{if(n.id===c.id)return 0;if(n.created_at===c.created_at)return-1;return n.created_at-c.created_at});if(!f)e.splice(r,0,n);return e}function Lr(e,n){let r=0,f=e.length-1;while(r<=f){const c=Math.floor((r+f)/2),l=n(e[c]);if(l===0)return[c,!0];if(l<0)f=c-1;else r=c+1}return[r,!1]}function al(e){if(!Xc(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function _n(e){let n=Ie(Qe.encode(al(e)));return k(n)}function Zc(e){return 1000<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Oc(e){return[0,3].includes(e)||1e4<=e&&e<20000}function Rc(e){return 20000<=e&&e<30000}function Vc(e){return 30000<=e&&e<40000}function hl(e){if(Zc(e))return"regular";if(Oc(e))return"replaceable";if(Rc(e))return"ephemeral";if(Vc(e))return"parameterized";return"unknown"}function c$(e,n){if(e.ids&&e.ids.indexOf(n.id)===-1)return!1;if(e.kinds&&e.kinds.indexOf(n.kind)===-1)return!1;if(e.authors&&e.authors.indexOf(n.pubkey)===-1)return!1;for(let r in e)if(r[0]==="#"){let f=r.slice(1),c=e[`#${f}`];if(c&&!n.tags.find(([l,w])=>l===r.slice(1)&&c.indexOf(w)!==-1))return!1}if(e.since&&n.created_at<e.since)return!1;if(e.until&&n.created_at>e.until)return!1;return!0}function l$(e,n){for(let r=0;r<e.length;r++)if(c$(e[r],n))return!0;return!1}function yn(e,n){let r=n.length+3,f=e.indexOf(`"${n}":`)+r,c=e.slice(f).indexOf('"')+f+1;return e.slice(c,c+64)}function Pc(e,n){let r=n.length,f=e.indexOf(`"${n}":`)+r+3,c=e.slice(f),l=Math.min(c.indexOf(","),c.indexOf("}"));return parseInt(c.slice(0,l),10)}function Cc(e){let n=e.slice(0,22).indexOf('"EVENT"');if(n===-1)return null;let r=e.slice(n+7+1).indexOf('"');if(r===-1)return null;let f=n+7+1+r,c=e.slice(f+1,80).indexOf('"');if(c===-1)return null;let l=f+1+c;return e.slice(f+1,l)}function $$(e,n){return n===yn(e,"id")}function g$(e,n){return n===yn(e,"pubkey")}function v$(e,n){return n===Pc(e,"kind")}function Bc(e,n){return{kind:uc,created_at:Math.floor(Date.now()/1000),tags:[["relay",e],["challenge",n]],content:""}}async function i$(){return new Promise((e)=>{const n=new MessageChannel,r=()=>{n.port1.removeEventListener("message",r),e()};n.port1.addEventListener("message",r),n.port2.postMessage(0),n.port1.start()})}function fn(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Ae(...e){const n=(c,l)=>(w)=>c(l(w)),r=Array.from(e).reverse().reduce((c,l)=>c?n(c,l.encode):l.encode,void 0),f=e.reduce((c,l)=>c?n(c,l.decode):l.decode,void 0);return{encode:r,decode:f}}function Ze(e){return{encode:(n)=>{if(!Array.isArray(n)||n.length&&typeof n[0]!=="number")throw new Error("alphabet.encode input should be an array of numbers");return n.map((r)=>{if(fn(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:(n)=>{if(!Array.isArray(n)||n.length&&typeof n[0]!=="string")throw new Error("alphabet.decode input should be array of strings");return n.map((r)=>{if(typeof r!=="string")throw new Error(`alphabet.decode: not string element=${r}`);const f=e.indexOf(r);if(f===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return f})}}}function Oe(e=""){if(typeof e!=="string")throw new Error("join separator should be string");return{encode:(n)=>{if(!Array.isArray(n)||n.length&&typeof n[0]!=="string")throw new Error("join.encode input should be array of strings");for(let r of n)if(typeof r!=="string")throw new Error(`join.encode: non-string input=${r}`);return n.join(e)},decode:(n)=>{if(typeof n!=="string")throw new Error("join.decode input should be string");return n.split(e)}}}function jn(e,n="="){if(fn(e),typeof n!=="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!=="string")throw new Error("padding.encode input should be array of strings");for(let f of r)if(typeof f!=="string")throw new Error(`padding.encode: non-string input=${f}`);while(r.length*e%8)r.push(n);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!=="string")throw new Error("padding.encode input should be array of strings");for(let c of r)if(typeof c!=="string")throw new Error(`padding.decode: non-string input=${c}`);let f=r.length;if(f*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;f>0&&r[f-1]===n;f--)if(!((f-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,f)}}}function hf(e){if(typeof e!=="function")throw new Error("normalize fn should be function");return{encode:(n)=>n,decode:(n)=>e(n)}}function mf(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let f=0;const c=[],l=Array.from(e);l.forEach((w)=>{if(fn(w),w<0||w>=n)throw new Error(`Wrong integer: ${w}`)});while(!0){let w=0,$=!0;for(let g=f;g<l.length;g++){const d=l[g],v=n*w+d;if(!Number.isSafeInteger(v)||n*w/n!==w||v-d!==n*w)throw new Error("convertRadix: carry overflow");if(w=v%r,l[g]=Math.floor(v/r),!Number.isSafeInteger(l[g])||l[g]*r+w!==v)throw new Error("convertRadix: carry overflow");if(!$)continue;else if(!l[g])f=g;else $=!1}if(c.push(w),$)break}for(let w=0;w<e.length-1&&e[w]===0;w++)c.push(0);return c.reverse()}function Nr(e,n,r,f){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(tn(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${tn(n,r)}`);let c=0,l=0;const w=2**r-1,$=[];for(let g of e){if(fn(g),g>=2**n)throw new Error(`convertRadix2: invalid data word=${g} from=${n}`);if(c=c<<n|g,l+n>32)throw new Error(`convertRadix2: carry overflow pos=${l} from=${n}`);l+=n;for(;l>=r;l-=r)$.push((c>>l-r&w)>>>0);c&=2**l-1}if(c=c<<r-l&w,!f&&l>=n)throw new Error("Excess padding");if(!f&&c)throw new Error(`Non-zero padding: ${c}`);if(f&&l>0)$.push(c>>>0);return $}function dl(e){return fn(e),{encode:(n)=>{if(!(n instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return mf(Array.from(n),256,e)},decode:(n)=>{if(!Array.isArray(n)||n.length&&typeof n[0]!=="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(mf(n,e,256))}}}function Ke(e,n=!1){if(fn(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(tn(8,e)>32||tn(e,8)>32)throw new Error("radix2: carry overflow");return{encode:(r)=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Nr(Array.from(r),8,e,!n)},decode:(r)=>{if(!Array.isArray(r)||r.length&&typeof r[0]!=="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Nr(r,e,8,n))}}}function Lf(e){if(typeof e!=="function")throw new Error("unsafeWrapper fn should be function");return function(...n){try{return e.apply(null,n)}catch(r){}}}function qn(e){const n=e>>25;let r=(e&33554431)<<5;for(let f=0;f<af.length;f++)if((n>>f&1)===1)r^=af[f];return r}function yf(e,n,r=1){const f=e.length;let c=1;for(let l=0;l<f;l++){const w=e.charCodeAt(l);if(w<33||w>126)throw new Error(`Invalid prefix (${e})`);c=qn(c)^w>>5}c=qn(c);for(let l=0;l<f;l++)c=qn(c)^e.charCodeAt(l)&31;for(let l of n)c=qn(c)^l;for(let l=0;l<6;l++)c=qn(c);return c^=r,Wr.encode(Nr([c%1073741824],30,5,!1))}function Ff(e){const n=e==="bech32"?1:734539939,r=Ke(5),f=r.decode,c=r.encode,l=Lf(f);function w(v,J,I=90){if(typeof v!=="string")throw new Error(`bech32.encode prefix should be string, not ${typeof v}`);if(!Array.isArray(J)||J.length&&typeof J[0]!=="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof J}`);const E=v.length+7+J.length;if(I!==!1&&E>I)throw new TypeError(`Length ${E} exceeds limit ${I}`);return v=v.toLowerCase(),`${v}1${Wr.encode(J)}${yf(v,J,n)}`}function $(v,J=90){if(typeof v!=="string")throw new Error(`bech32.decode input should be string, not ${typeof v}`);if(v.length<8||J!==!1&&v.length>J)throw new TypeError(`Wrong string length: ${v.length} (${v}). Expected (8..${J})`);const I=v.toLowerCase();if(v!==I&&v!==v.toUpperCase())throw new Error("String must be lowercase or uppercase");v=I;const E=v.lastIndexOf("1");if(E===0||E===-1)throw new Error('Letter "1" must be present between prefix and data only');const i=v.slice(0,E),q=v.slice(E+1);if(q.length<6)throw new Error("Data must be at least 6 characters long");const Q=Wr.decode(q).slice(0,-6),G=yf(i,Q,n);if(!q.endsWith(G))throw new Error(`Invalid checksum in ${v}: expected "${G}"`);return{prefix:i,words:Q}}const g=Lf($);function d(v){const{prefix:J,words:I}=$(v,!1);return{prefix:J,words:I,bytes:f(I)}}return{encode:w,decode:$,decodeToBytes:d,decodeUnsafe:g,fromWords:f,fromWordsUnsafe:l,toWords:c}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */var bf=(e,n)=>!n?e:bf(n,e%n),tn=(e,n)=>e+(n-bf(e,n));var il=Ae(Ke(4),Ze("0123456789ABCDEF"),Oe("")),Jl=Ae(Ke(5),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),jn(5),Oe("")),Ng=Ae(Ke(5),Ze("0123456789ABCDEFGHIJKLMNOPQRSTUV"),jn(5),Oe("")),Tg=Ae(Ke(5),Ze("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Oe(""),hf((e)=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),le=Ae(Ke(6),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),jn(6),Oe("")),ql=Ae(Ke(6),Ze("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),jn(6),Oe("")),Yr=(e)=>Ae(dl(58),Ze(e),Oe("")),Tr=Yr("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Wg=Yr("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Yg=Yr("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),_f=[0,2,3,5,6,7,9,10,11],Il={encode(e){let n="";for(let r=0;r<e.length;r+=8){const f=e.subarray(r,r+8);n+=Tr.encode(f).padStart(_f[f.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const f=e.slice(r,r+11),c=_f.indexOf(f.length),l=Tr.decode(f);for(let w=0;w<l.length-c;w++)if(l[w]!==0)throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(l.slice(l.length-c)))}return Uint8Array.from(n)}};var Wr=Ae(Ze("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Oe("")),af=[996825010,642813549,513874426,1027748829,705979059],re=Ff("bech32"),Ag=Ff("bech32m"),Ql={encode:(e)=>new TextDecoder().decode(e),decode:(e)=>new TextEncoder().encode(e)},El=Ae(Ke(4),Ze("0123456789abcdef"),Oe(""),hf((e)=>{if(typeof e!=="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Gl={utf8:Ql,hex:El,base16:il,base32:Jl,base64:le,base64url:ql,base58:Tr,base58xmr:Il},Zg=`Invalid encoding type. Available types: ${Object.keys(Gl).join(", ")}`;function E$(e){const n=new Uint8Array(4);return n[0]=e>>24&255,n[1]=e>>16&255,n[2]=e>>8&255,n[3]=e&255,n}function hn(e){let{prefix:n,words:r}=re.decode(e,Fr),f=new Uint8Array(re.fromWords(r));switch(n){case"nprofile":{let c=Ln(f);if(!c[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(c[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:k(c[0][0]),relays:c[1]?c[1].map((l)=>Xe.decode(l)):[]}}}case"nevent":{let c=Ln(f);if(!c[0]?.[0])throw new Error("missing TLV 0 for nevent");if(c[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(c[2]&&c[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(c[3]&&c[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:k(c[0][0]),relays:c[1]?c[1].map((l)=>Xe.decode(l)):[],author:c[2]?.[0]?k(c[2][0]):void 0,kind:c[3]?.[0]?parseInt(k(c[3][0]),16):void 0}}}case"naddr":{let c=Ln(f);if(!c[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!c[2]?.[0])throw new Error("missing TLV 2 for naddr");if(c[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!c[3]?.[0])throw new Error("missing TLV 3 for naddr");if(c[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Xe.decode(c[0][0]),pubkey:k(c[2][0]),kind:parseInt(k(c[3][0]),16),relays:c[1]?c[1].map((l)=>Xe.decode(l)):[]}}}case"nrelay":{let c=Ln(f);if(!c[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Xe.decode(c[0][0])}}case"nsec":return{type:n,data:f};case"npub":case"note":return{type:n,data:k(f)};default:throw new Error(`unknown prefix ${n}`)}}function Ln(e){let n={},r=e;while(r.length>0){let f=r[0],c=r[1],l=r.slice(2,2+c);if(r=r.slice(2+c),l.length<c)throw new Error(`not enough data to read on TLV ${f}`);n[f]=n[f]||[],n[f].push(l)}return n}function G$(e){return bn("nsec",e)}function M$(e){return bn("npub",te(e))}function z$(e){return bn("note",te(e))}function En(e,n){let r=re.toWords(n);return re.encode(e,r,Fr)}function bn(e,n){return En(e,n)}function o$(e){let n=Fn({0:[te(e.pubkey)],1:(e.relays||[]).map((r)=>Qe.encode(r))});return En("nprofile",n)}function U$(e){let n;if(e.kind!==void 0)n=E$(e.kind);let r=Fn({0:[te(e.id)],1:(e.relays||[]).map((f)=>Qe.encode(f)),2:e.author?[te(e.author)]:[],3:n?[new Uint8Array(n)]:[]});return En("nevent",r)}function X$(e){let n=new ArrayBuffer(4);new DataView(n).setUint32(0,e.kind,!1);let r=Fn({0:[Qe.encode(e.identifier)],1:(e.relays||[]).map((f)=>Qe.encode(f)),2:[te(e.pubkey)],3:[new Uint8Array(n)]});return En("naddr",r)}function N$(e){let n=Fn({0:[Qe.encode(e)]});return En("nrelay",n)}function Fn(e){let n=[];return Object.entries(e).reverse().forEach(([r,f])=>{f.forEach((c)=>{let l=new Uint8Array(c.length+2);l.set([parseInt(r)],0),l.set([c.length],1),l.set(c,2),n.push(l)})}),Ye(...n)}function un(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ar(e){if(typeof e!=="boolean")throw new Error(`boolean expected, not ${e}`)}function Zr(e){return e instanceof Uint8Array||e!=null&&typeof e==="object"&&e.constructor.name==="Uint8Array"}function C(e,...n){if(!Zr(e))throw new Error("Uint8Array expected");if(n.length>0&&!n.includes(e.length))throw new Error(`Uint8Array expected of length ${n}, not of length=${e.length}`)}function Pe(e,n=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(n&&e.finished)throw new Error("Hash#digest() has already been called")}function In(e,n){C(e);const r=n.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}function zl(e){if(typeof e!=="string")throw new Error(`string expected, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Me(e){if(typeof e==="string")e=zl(e);else if(Zr(e))e=e.slice();else throw new Error(`Uint8Array expected, got ${typeof e}`);return e}function kf(e,n){if(n==null||typeof n!=="object")throw new Error("options must be defined");return Object.assign(e,n)}function ke(e,n){if(e.length!==n.length)return!1;let r=0;for(let f=0;f<e.length;f++)r|=e[f]^n[f];return r===0}function se(e,n,r,f){if(typeof e.setBigUint64==="function")return e.setBigUint64(n,r,f);const c=BigInt(32),l=BigInt(4294967295),w=Number(r>>c&l),$=Number(r&l),g=f?4:0,d=f?0:4;e.setUint32(n+g,w,f),e.setUint32(n+d,$,f)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */var Kn=(e)=>new Uint8Array(e.buffer,e.byteOffset,e.byteLength);var B=(e)=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Ce=(e)=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ml=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ml)throw new Error("Non little-endian hardware is not supported");var ze=(e,n)=>{return Object.assign(n,e),n};function Xl(e){e.reverse();const n=e[15]&1;let r=0;for(let f=0;f<e.length;f++){const c=e[f];e[f]=c>>>1|r,r=(c&1)<<7}return e[0]^=-n&225,e}function xf(e){const n=(f,c)=>e(c,f.length).update(Me(f)).digest(),r=e(new Uint8Array(16),0);return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=(f,c)=>e(f,c),n}var Re=16,Or=new Uint8Array(16),oe=B(Or),ol=225,Ul=(e,n,r,f)=>{const c=f&1;return{s3:r<<31|f>>>1,s2:n<<31|r>>>1,s1:e<<31|n>>>1,s0:e>>>1^ol<<24&-(c&1)}},$e=(e)=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255|0,Nl=(e)=>{if(e>65536)return 8;if(e>1024)return 4;return 2};class Rr{constructor(e,n){this.blockLen=Re,this.outputLen=Re,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=Me(e),C(e,16);const r=Ce(e);let f=r.getUint32(0,!1),c=r.getUint32(4,!1),l=r.getUint32(8,!1),w=r.getUint32(12,!1);const $=[];for(let E=0;E<128;E++)$.push({s0:$e(f),s1:$e(c),s2:$e(l),s3:$e(w)}),{s0:f,s1:c,s2:l,s3:w}=Ul(f,c,l,w);const g=Nl(n||1024);if(![1,2,4,8].includes(g))throw new Error(`ghash: wrong window size=${g}, should be 2, 4 or 8`);this.W=g;const v=128/g,J=this.windowSize=2**g,I=[];for(let E=0;E<v;E++)for(let i=0;i<J;i++){let q=0,Q=0,G=0,M=0;for(let U=0;U<g;U++){if(!(i>>>g-U-1&1))continue;const{s0:N,s1:W,s2:Y,s3:D}=$[g*E+U];q^=N,Q^=W,G^=Y,M^=D}I.push({s0:q,s1:Q,s2:G,s3:M})}this.t=I}_updateBlock(e,n,r,f){e^=this.s0,n^=this.s1,r^=this.s2,f^=this.s3;const{W:c,t:l,windowSize:w}=this;let $=0,g=0,d=0,v=0;const J=(1<<c)-1;let I=0;for(let E of[e,n,r,f])for(let i=0;i<4;i++){const q=E>>>8*i&255;for(let Q=8/c-1;Q>=0;Q--){const G=q>>>c*Q&J,{s0:M,s1:U,s2:X,s3:N}=l[I*w+G];$^=M,g^=U,d^=X,v^=N,I+=1}}this.s0=$,this.s1=g,this.s2=d,this.s3=v}update(e){e=Me(e),Pe(this);const n=B(e),r=Math.floor(e.length/Re),f=e.length%Re;for(let c=0;c<r;c++)this._updateBlock(n[c*4+0],n[c*4+1],n[c*4+2],n[c*4+3]);if(f)Or.set(e.subarray(r*Re)),this._updateBlock(oe[0],oe[1],oe[2],oe[3]),oe.fill(0);return this}destroy(){const{t:e}=this;for(let n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){Pe(this),In(e,this),this.finished=!0;const{s0:n,s1:r,s2:f,s3:c}=this,l=B(e);return l[0]=n,l[1]=r,l[2]=f,l[3]=c,e}digest(){const e=new Uint8Array(Re);return this.digestInto(e),this.destroy(),e}}class sf extends Rr{constructor(e,n){e=Me(e);const r=Xl(e.slice());super(r,n);r.fill(0)}update(e){e=Me(e),Pe(this);const n=B(e),r=e.length%Re,f=Math.floor(e.length/Re);for(let c=0;c<f;c++)this._updateBlock($e(n[c*4+3]),$e(n[c*4+2]),$e(n[c*4+1]),$e(n[c*4+0]));if(r)Or.set(e.subarray(f*Re)),this._updateBlock($e(oe[3]),$e(oe[2]),$e(oe[1]),$e(oe[0])),oe.fill(0);return this}digestInto(e){Pe(this),In(e,this),this.finished=!0;const{s0:n,s1:r,s2:f,s3:c}=this,l=B(e);return l[0]=n,l[1]=r,l[2]=f,l[3]=c,e.reverse()}}var Vr=xf((e,n)=>new Rr(e,n)),pf=xf((e,n)=>new sf(e,n));function tr(e){return e<<1^Tl&-(e>>7)}function cn(e,n){let r=0;for(;n>0;n>>=1)r^=e&-(n&1),e=tr(e);return r}function ec(e,n){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((d,v)=>n(e[v])),f=r.map(Dr),c=f.map(Dr),l=c.map(Dr),w=new Uint32Array(65536),$=new Uint32Array(65536),g=new Uint16Array(65536);for(let d=0;d<256;d++)for(let v=0;v<256;v++){const J=d*256+v;w[J]=r[d]^f[v],$[J]=c[d]^l[v],g[J]=e[d]<<8|e[v]}return{sbox:e,sbox2:g,T0:r,T1:f,T2:c,T3:l,T01:w,T23:$}}function me(e){C(e);const n=e.length;if(![16,24,32].includes(n))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${n}`);const{sbox2:r}=jr,f=B(e),c=f.length,l=($)=>Ue(r,$,$,$,$),w=new Uint32Array(n+28);w.set(f);for(let $=c;$<w.length;$++){let g=w[$-1];if($%c===0)g=l(Yl(g))^Al[$/c-1];else if(c>6&&$%c===4)g=l(g);w[$]=w[$-c]^g}return w}function rc(e){const n=me(e),r=n.slice(),f=n.length,{sbox2:c}=jr,{T0:l,T1:w,T2:$,T3:g}=nc;for(let d=0;d<f;d+=4)for(let v=0;v<4;v++)r[d+v]=n[f-d-4+v];n.fill(0);for(let d=4;d<f-4;d++){const v=r[d],J=Ue(c,v,v,v,v);r[d]=l[J&255]^w[J>>>8&255]^$[J>>>16&255]^g[J>>>24]}return r}function Be(e,n,r,f,c,l){return e[r<<8&65280|f>>>8&255]^n[c>>>8&65280|l>>>24&255]}function Ue(e,n,r,f,c){return e[n&255|r&65280]|e[f>>>16&255|c>>>16&65280]<<16}function ge(e,n,r,f,c){const{sbox2:l,T01:w,T23:$}=jr;let g=0;n^=e[g++],r^=e[g++],f^=e[g++],c^=e[g++];const d=e.length/4-2;for(let i=0;i<d;i++){const q=e[g++]^Be(w,$,n,r,f,c),Q=e[g++]^Be(w,$,r,f,c,n),G=e[g++]^Be(w,$,f,c,n,r),M=e[g++]^Be(w,$,c,n,r,f);n=q,r=Q,f=G,c=M}const v=e[g++]^Ue(l,n,r,f,c),J=e[g++]^Ue(l,r,f,c,n),I=e[g++]^Ue(l,f,c,n,r),E=e[g++]^Ue(l,c,n,r,f);return{s0:v,s1:J,s2:I,s3:E}}function fc(e,n,r,f,c){const{sbox2:l,T01:w,T23:$}=nc;let g=0;n^=e[g++],r^=e[g++],f^=e[g++],c^=e[g++];const d=e.length/4-2;for(let i=0;i<d;i++){const q=e[g++]^Be(w,$,n,c,f,r),Q=e[g++]^Be(w,$,r,n,c,f),G=e[g++]^Be(w,$,f,r,n,c),M=e[g++]^Be(w,$,c,f,r,n);n=q,r=Q,f=G,c=M}const v=e[g++]^Ue(l,n,c,f,r),J=e[g++]^Ue(l,r,n,c,f),I=e[g++]^Ue(l,f,r,n,c),E=e[g++]^Ue(l,c,f,r,n);return{s0:v,s1:J,s2:I,s3:E}}function ln(e,n){if(!n)return new Uint8Array(e);if(C(n),n.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${n.length}`);return n}function Zl(e,n,r,f){C(n,p),C(r);const c=r.length;f=ln(c,f);const l=n,w=B(l);let{s0:$,s1:g,s2:d,s3:v}=ge(e,w[0],w[1],w[2],w[3]);const J=B(r),I=B(f);for(let i=0;i+4<=J.length;i+=4){I[i+0]=J[i+0]^$,I[i+1]=J[i+1]^g,I[i+2]=J[i+2]^d,I[i+3]=J[i+3]^v;let q=1;for(let Q=l.length-1;Q>=0;Q--)q=q+(l[Q]&255)|0,l[Q]=q&255,q>>>=8;({s0:$,s1:g,s2:d,s3:v}=ge(e,w[0],w[1],w[2],w[3]))}const E=p*Math.floor(J.length/Sr);if(E<c){const i=new Uint32Array([$,g,d,v]),q=Kn(i);for(let Q=E,G=0;Q<c;Q++,G++)f[Q]=r[Q]^q[G]}return f}function Qn(e,n,r,f,c){C(r,p),C(f),c=ln(f.length,c);const l=r,w=B(l),$=Ce(l),g=B(f),d=B(c),v=n?0:12,J=f.length;let I=$.getUint32(v,n),{s0:E,s1:i,s2:q,s3:Q}=ge(e,w[0],w[1],w[2],w[3]);for(let M=0;M+4<=g.length;M+=4)d[M+0]=g[M+0]^E,d[M+1]=g[M+1]^i,d[M+2]=g[M+2]^q,d[M+3]=g[M+3]^Q,I=I+1>>>0,$.setUint32(v,I,n),{s0:E,s1:i,s2:q,s3:Q}=ge(e,w[0],w[1],w[2],w[3]);const G=p*Math.floor(g.length/Sr);if(G<J){const M=new Uint32Array([E,i,q,Q]),U=Kn(M);for(let X=G,N=0;X<J;X++,N++)c[X]=f[X]^U[N]}return c}function cc(e){if(C(e),e.length%p!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${p}`)}function lc(e,n,r){let f=e.length;const c=f%p;if(!n&&c!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const l=B(e);if(n){let g=p-c;if(!g)g=p;f=f+g}const w=ln(f,r),$=B(w);return{b:l,o:$,out:w}}function wc(e,n){if(!n)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const f=e[r-1];if(f<=0||f>16)throw new Error(`aes/pcks5: wrong padding byte: ${f}`);const c=e.subarray(0,-f);for(let l=0;l<f;l++)if(e[r-l-1]!==f)throw new Error("aes/pcks5: wrong padding");return c}function $c(e){const n=new Uint8Array(16),r=B(n);n.set(e);const f=p-e.length;for(let c=p-f;c<p;c++)n[c]=f;return r}function gc(e,n,r,f,c){const l=e.create(r,f.length+(c?.length||0));if(c)l.update(c);l.update(f);const w=new Uint8Array(16),$=Ce(w);if(c)se($,0,BigInt(c.length*8),n);return se($,8,BigInt(f.length*8),n),l.update(w),l.digest()}var p=16,Sr=4,Pn=new Uint8Array(p),Tl=283,Hr=(()=>{let e=new Uint8Array(256);for(let r=0,f=1;r<256;r++,f^=tr(f))e[r]=f;const n=new Uint8Array(256);n[0]=99;for(let r=0;r<255;r++){let f=e[255-r];f|=f<<8,n[e[r]]=(f^f>>4^f>>5^f>>6^f>>7^99)&255}return n})(),Wl=Hr.map((e,n)=>Hr.indexOf(n)),Yl=(e)=>e<<24|e>>>8,Dr=(e)=>e<<8|e>>>24,jr=ec(Hr,(e)=>cn(e,3)<<24|e<<16|e<<8|cn(e,2)),nc=ec(Wl,(e)=>cn(e,11)<<24|cn(e,13)<<16|cn(e,9)<<8|cn(e,14)),Al=(()=>{const e=new Uint8Array(16);for(let n=0,r=1;n<16;n++,r=tr(r))e[n]=r;return e})(),Pg=ze({blockSize:16,nonceLength:16},function e(n,r){C(n),C(r,p);function f(c,l){const w=me(n),$=r.slice(),g=Zl(w,$,c,l);return w.fill(0),$.fill(0),g}return{encrypt:(c,l)=>f(c,l),decrypt:(c,l)=>f(c,l)}}),Cg=ze({blockSize:16},function e(n,r={}){C(n);const f=!r.disablePadding;return{encrypt:(c,l)=>{C(c);const{b:w,o:$,out:g}=lc(c,f,l),d=me(n);let v=0;for(;v+4<=w.length;){const{s0:J,s1:I,s2:E,s3:i}=ge(d,w[v+0],w[v+1],w[v+2],w[v+3]);$[v++]=J,$[v++]=I,$[v++]=E,$[v++]=i}if(f){const J=$c(c.subarray(v*4)),{s0:I,s1:E,s2:i,s3:q}=ge(d,J[0],J[1],J[2],J[3]);$[v++]=I,$[v++]=E,$[v++]=i,$[v++]=q}return d.fill(0),g},decrypt:(c,l)=>{cc(c);const w=rc(n),$=ln(c.length,l),g=B(c),d=B($);for(let v=0;v+4<=g.length;){const{s0:J,s1:I,s2:E,s3:i}=fc(w,g[v+0],g[v+1],g[v+2],g[v+3]);d[v++]=J,d[v++]=I,d[v++]=E,d[v++]=i}return w.fill(0),wc($,f)}}}),ur=ze({blockSize:16,nonceLength:16},function e(n,r,f={}){C(n),C(r,16);const c=!f.disablePadding;return{encrypt:(l,w)=>{const $=me(n),{b:g,o:d,out:v}=lc(l,c,w),J=B(r);let I=J[0],E=J[1],i=J[2],q=J[3],Q=0;for(;Q+4<=g.length;)I^=g[Q+0],E^=g[Q+1],i^=g[Q+2],q^=g[Q+3],{s0:I,s1:E,s2:i,s3:q}=ge($,I,E,i,q),d[Q++]=I,d[Q++]=E,d[Q++]=i,d[Q++]=q;if(c){const G=$c(l.subarray(Q*4));I^=G[0],E^=G[1],i^=G[2],q^=G[3],{s0:I,s1:E,s2:i,s3:q}=ge($,I,E,i,q),d[Q++]=I,d[Q++]=E,d[Q++]=i,d[Q++]=q}return $.fill(0),v},decrypt:(l,w)=>{cc(l);const $=rc(n),g=B(r),d=ln(l.length,w),v=B(l),J=B(d);let I=g[0],E=g[1],i=g[2],q=g[3];for(let Q=0;Q+4<=v.length;){const G=I,M=E,U=i,X=q;I=v[Q+0],E=v[Q+1],i=v[Q+2],q=v[Q+3];const{s0:N,s1:W,s2:Y,s3:D}=fc($,I,E,i,q);J[Q++]=N^G,J[Q++]=W^M,J[Q++]=Y^U,J[Q++]=D^X}return $.fill(0),wc(d,c)}}}),Bg=ze({blockSize:16,nonceLength:16},function e(n,r){C(n),C(r,16);function f(c,l,w){const $=me(n),g=c.length;w=ln(g,w);const d=B(c),v=B(w),J=l?v:d,I=B(r);let E=I[0],i=I[1],q=I[2],Q=I[3];for(let M=0;M+4<=d.length;){const{s0:U,s1:X,s2:N,s3:W}=ge($,E,i,q,Q);v[M+0]=d[M+0]^U,v[M+1]=d[M+1]^X,v[M+2]=d[M+2]^N,v[M+3]=d[M+3]^W,E=J[M++],i=J[M++],q=J[M++],Q=J[M++]}const G=p*Math.floor(d.length/Sr);if(G<g){({s0:E,s1:i,s2:q,s3:Q}=ge($,E,i,q,Q));const M=Kn(new Uint32Array([E,i,q,Q]));for(let U=G,X=0;U<g;U++,X++)w[U]=c[U]^M[X];M.fill(0)}return $.fill(0),w}return{encrypt:(c,l)=>f(c,!0,l),decrypt:(c,l)=>f(c,!1,l)}}),mg=ze({blockSize:16,nonceLength:12,tagLength:16},function e(n,r,f){if(C(r),r.length===0)throw new Error("aes/gcm: empty nonce");const c=16;function l($,g,d){const v=gc(Vr,!1,$,d,f);for(let J=0;J<g.length;J++)v[J]^=g[J];return v}function w(){const $=me(n),g=Pn.slice(),d=Pn.slice();if(Qn($,!1,d,d,g),r.length===12)d.set(r);else{const J=Pn.slice(),I=Ce(J);se(I,8,BigInt(r.length*8),!1),Vr.create(g).update(r).update(J).digestInto(d)}const v=Qn($,!1,d,Pn);return{xk:$,authKey:g,counter:d,tagMask:v}}return{encrypt:($)=>{C($);const{xk:g,authKey:d,counter:v,tagMask:J}=w(),I=new Uint8Array($.length+c);Qn(g,!1,v,$,I);const E=l(d,J,I.subarray(0,I.length-c));return I.set(E,$.length),g.fill(0),I},decrypt:($)=>{if(C($),$.length<c)throw new Error(`aes/gcm: ciphertext less than tagLen (${c})`);const{xk:g,authKey:d,counter:v,tagMask:J}=w(),I=$.subarray(0,-c),E=$.subarray(-c),i=l(d,J,I);if(!ke(i,E))throw new Error("aes/gcm: invalid ghash tag");const q=Qn(g,!1,v,I);return d.fill(0),J.fill(0),g.fill(0),q}}}),Cn=(e,n,r)=>(f)=>{if(!Number.isSafeInteger(f)||n>f||f>r)throw new Error(`${e}: invalid value=${f}, must be [${n}..${r}]`)},Lg=ze({blockSize:16,nonceLength:12,tagLength:16},function e(n,r,f){const l=Cn("AAD",0,68719476736),w=Cn("plaintext",0,68719476736),$=Cn("nonce",12,12),g=Cn("ciphertext",16,68719476752);if(C(r),$(r.length),f)C(f),l(f.length);function d(){const I=n.length;if(I!==16&&I!==24&&I!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${I} bytes`);const E=me(n),i=new Uint8Array(I),q=new Uint8Array(16),Q=B(r);let G=0,M=Q[0],U=Q[1],X=Q[2],N=0;for(let W of[q,i].map(B)){const Y=B(W);for(let D=0;D<Y.length;D+=2){const{s0:R,s1:O}=ge(E,G,M,U,X);Y[D+0]=R,Y[D+1]=O,G=++N}}return E.fill(0),{authKey:q,encKey:me(i)}}function v(I,E,i){const q=gc(pf,!0,E,i,f);for(let N=0;N<12;N++)q[N]^=r[N];q[15]&=127;const Q=B(q);let G=Q[0],M=Q[1],U=Q[2],X=Q[3];return{s0:G,s1:M,s2:U,s3:X}=ge(I,G,M,U,X),Q[0]=G,Q[1]=M,Q[2]=U,Q[3]=X,q}function J(I,E,i){let q=E.slice();return q[15]|=128,Qn(I,!0,q,i)}return{encrypt:(I)=>{C(I),w(I.length);const{encKey:E,authKey:i}=d(),q=v(E,i,I),Q=new Uint8Array(I.length+16);return Q.set(q,I.length),Q.set(J(E,q,I)),E.fill(0),i.fill(0),Q},decrypt:(I)=>{C(I),g(I.length);const E=I.subarray(-16),{encKey:i,authKey:q}=d(),Q=J(i,E,I.subarray(0,-16)),G=v(i,q,Q);if(i.fill(0),q.fill(0),!ke(E,G))throw new Error("invalid polyval tag");return Q}}});async function Lc(e,n,r){const f=e instanceof Uint8Array?k(e):e,c=Se.getSharedSecret(f,"02"+n),l=_c(c);let w=Uint8Array.from(Fe(16)),$=Qe.encode(r),g=ur(l,w).encrypt($),d=le.encode(new Uint8Array(g)),v=le.encode(new Uint8Array(w.buffer));return`${d}?iv=${v}`}async function T$(e,n,r){const f=e instanceof Uint8Array?k(e):e;let[c,l]=r.split("?iv="),w=Se.getSharedSecret(f,"02"+n),$=_c(w),g=le.decode(l),d=le.decode(c),v=ur($,g).decrypt(d);return Xe.decode(v)}function _c(e){return e.slice(1,33)}function Y$(e){kn=e}async function A$(e,n=""){try{const r=`https://${e}/.well-known/nostr.json?name=${n}`;return(await(await kn(r,{redirect:"error"})).json()).names}catch(r){return{}}}async function yc(e){const n=e.match(ac);if(!n)return null;const[r,f="_",c]=n;try{const l=`https://${c}/.well-known/nostr.json?name=${f}`,w=await(await kn(l,{redirect:"error"})).json();let $=w.names[f];return $?{pubkey:$,relays:w.relays?.[$]}:null}catch(l){return null}}async function Z$(e,n){let r=await yc(n);return r?r.pubkey===e:!1}function R$(e){const n={reply:void 0,root:void 0,mentions:[],profiles:[]},r=[];for(let f of e.tags){if(f[0]==="e"&&f[1])r.push(f);if(f[0]==="p"&&f[1])n.profiles.push({pubkey:f[1],relays:f[2]?[f[2]]:[]})}for(let f=0;f<r.length;f++){const c=r[f],[l,w,$,g]=c,d={id:w,relays:$?[$]:[]},v=f===0,J=f===r.length-1;if(g==="root"){n.root=d;continue}if(g==="reply"){n.reply=d;continue}if(g==="mention"){n.mentions.push(d);continue}if(v){n.root=d;continue}if(J){n.reply=d;continue}n.mentions.push(d)}return n}function D$(e){hc=e}async function H$(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function bc(e){let n=0;for(let r=0;r<e.length;r++){const f=parseInt(e[r],16);if(f===0)n+=4;else{n+=Math.clz32(f)-28;break}}return n}function t$(e,n){let r=0;const f=e,c=["nonce",r.toString(),n.toString()];f.tags.push(c);while(!0){const l=Math.floor(new Date().getTime()/1000);if(l!==f.created_at)r=0,f.created_at=l;if(c[1]=(++r).toString(),f.id=_n(f),bc(f.id)>=n)break}return f}function u$(e,n,r,f){return Ne({kind:ar,tags:[...e.tags??[],["e",n.id,r],["p",n.pubkey]],content:e.content===""?"":JSON.stringify(n),created_at:e.created_at},f)}function Fc(e){if(e.kind!==ar)return;let n,r;for(let f=e.tags.length-1;f>=0&&(n===void 0||r===void 0);f--){const c=e.tags[f];if(c.length>=2){if(c[0]==="e"&&n===void 0)n=c;else if(c[0]==="p"&&r===void 0)r=c}}if(n===void 0)return;return{id:n[1],relays:[n[2],r?.[2]].filter((f)=>typeof f==="string"),author:r?.[1]}}function K$(e,{skipVerification:n}={}){const r=Fc(e);if(r===void 0||e.content==="")return;let f;try{f=JSON.parse(e.content)}catch(c){return}if(f.id!==r.id)return;if(!n&&!_r(f))return;return f}function C$(e){return typeof e==="string"&&new RegExp(`^${sn.source}\$`).test(e)}function B$(e){const n=e.match(new RegExp(`^${sn.source}\$`));if(!n)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:n[0],value:n[1],decoded:hn(n[1])}}function L$(e,n,r){const f=n.tags.filter((c)=>c.length>=2&&(c[0]==="e"||c[0]==="p"));return Ne({...e,kind:yr,tags:[...e.tags??[],...f,["e",n.id],["p",n.pubkey]],content:e.content??"+"},r)}function _$(e){if(e.kind!==yr)return;let n,r;for(let f=e.tags.length-1;f>=0&&(n===void 0||r===void 0);f--){const c=e.tags[f];if(c.length>=2){if(c[0]==="e"&&n===void 0)n=c;else if(c[0]==="p"&&r===void 0)r=c}}if(n===void 0||r===void 0)return;return{id:n[1],relays:[n[2],r[2]].filter((f)=>f!==void 0),author:r[1]}}function*y$(e){const n=e.matchAll(sr());for(let r of n)try{const[f,c]=r;yield{uri:f,value:c,decoded:hn(c),start:r.index,end:r.index+f.length}}catch(f){}}function h$(e,n){return e.replaceAll(sr(),(r,f)=>{return n({uri:r,value:f,decoded:hn(f)})})}function*n8(e){const n=e.matchAll(xr());for(let r of n)try{const[f,c]=r;yield{shortcode:f,name:c,start:r.index,end:r.index+f.length}}catch(f){}}function r8(e,n){return e.replaceAll(xr(),(r,f)=>{return n({shortcode:r,name:f})})}function c8(e){pr=e}async function l8(e,n,r){try{return await(await pr(`https://gist.github.com/${n}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(f){return!1}}function Ol(e){const n=(f,c)=>e(c).update(Me(f)).digest(),r=e(new Uint8Array(32));return n.outputLen=r.outputLen,n.blockLen=r.blockLen,n.create=(f)=>e(f),n}var x=(e,n)=>e[n++]&255|(e[n++]&255)<<8;class vc{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Me(e),C(e,32);const n=x(e,0),r=x(e,2),f=x(e,4),c=x(e,6),l=x(e,8),w=x(e,10),$=x(e,12),g=x(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|f<<6)&7939,this.r[3]=(f>>>7|c<<9)&8191,this.r[4]=(c>>>4|l<<12)&255,this.r[5]=l>>>1&8190,this.r[6]=(l>>>14|w<<2)&8191,this.r[7]=(w>>>11|$<<5)&8065,this.r[8]=($>>>8|g<<8)&8191,this.r[9]=g>>>5&127;for(let d=0;d<8;d++)this.pad[d]=x(e,16+2*d)}process(e,n,r=!1){const f=r?0:2048,{h:c,r:l}=this,w=l[0],$=l[1],g=l[2],d=l[3],v=l[4],J=l[5],I=l[6],E=l[7],i=l[8],q=l[9],Q=x(e,n+0),G=x(e,n+2),M=x(e,n+4),U=x(e,n+6),X=x(e,n+8),N=x(e,n+10),W=x(e,n+12),Y=x(e,n+14);let D=c[0]+(Q&8191),R=c[1]+((Q>>>13|G<<3)&8191),O=c[2]+((G>>>10|M<<6)&8191),t=c[3]+((M>>>7|U<<9)&8191),j=c[4]+((U>>>4|X<<12)&8191),u=c[5]+(X>>>1&8191),H=c[6]+((X>>>14|N<<2)&8191),z=c[7]+((N>>>11|W<<5)&8191),T=c[8]+((W>>>8|Y<<8)&8191),Z=c[9]+(Y>>>5|f),o=0,V=o+D*w+R*(5*q)+O*(5*i)+t*(5*E)+j*(5*I);o=V>>>13,V&=8191,V+=u*(5*J)+H*(5*v)+z*(5*d)+T*(5*g)+Z*(5*$),o+=V>>>13,V&=8191;let S=o+D*$+R*w+O*(5*q)+t*(5*i)+j*(5*E);o=S>>>13,S&=8191,S+=u*(5*I)+H*(5*J)+z*(5*v)+T*(5*d)+Z*(5*g),o+=S>>>13,S&=8191;let K=o+D*g+R*$+O*w+t*(5*q)+j*(5*i);o=K>>>13,K&=8191,K+=u*(5*E)+H*(5*I)+z*(5*J)+T*(5*v)+Z*(5*d),o+=K>>>13,K&=8191;let P=o+D*d+R*g+O*$+t*w+j*(5*q);o=P>>>13,P&=8191,P+=u*(5*i)+H*(5*E)+z*(5*I)+T*(5*J)+Z*(5*v),o+=P>>>13,P&=8191;let y=o+D*v+R*d+O*g+t*$+j*w;o=y>>>13,y&=8191,y+=u*(5*q)+H*(5*i)+z*(5*E)+T*(5*I)+Z*(5*J),o+=y>>>13,y&=8191;let ee=o+D*J+R*v+O*d+t*g+j*$;o=ee>>>13,ee&=8191,ee+=u*w+H*(5*q)+z*(5*i)+T*(5*E)+Z*(5*I),o+=ee>>>13,ee&=8191;let fe=o+D*I+R*J+O*v+t*d+j*g;o=fe>>>13,fe&=8191,fe+=u*$+H*w+z*(5*q)+T*(5*i)+Z*(5*E),o+=fe>>>13,fe&=8191;let ne=o+D*E+R*I+O*J+t*v+j*d;o=ne>>>13,ne&=8191,ne+=u*g+H*$+z*w+T*(5*q)+Z*(5*i),o+=ne>>>13,ne&=8191;let ve=o+D*i+R*E+O*I+t*J+j*v;o=ve>>>13,ve&=8191,ve+=u*d+H*g+z*$+T*w+Z*(5*q),o+=ve>>>13,ve&=8191;let Ee=o+D*q+R*i+O*E+t*I+j*J;o=Ee>>>13,Ee&=8191,Ee+=u*v+H*d+z*g+T*$+Z*w,o+=Ee>>>13,Ee&=8191,o=(o<<2)+o|0,o=o+V|0,V=o&8191,o=o>>>13,S+=o,c[0]=V,c[1]=S,c[2]=K,c[3]=P,c[4]=y,c[5]=ee,c[6]=fe,c[7]=ne,c[8]=ve,c[9]=Ee}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let f=e[1]>>>13;e[1]&=8191;for(let w=2;w<10;w++)e[w]+=f,f=e[w]>>>13,e[w]&=8191;e[0]+=f*5,f=e[0]>>>13,e[0]&=8191,e[1]+=f,f=e[1]>>>13,e[1]&=8191,e[2]+=f,r[0]=e[0]+5,f=r[0]>>>13,r[0]&=8191;for(let w=1;w<10;w++)r[w]=e[w]+f,f=r[w]>>>13,r[w]&=8191;r[9]-=8192;let c=(f^1)-1;for(let w=0;w<10;w++)r[w]&=c;c=~c;for(let w=0;w<10;w++)e[w]=e[w]&c|r[w];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let l=e[0]+n[0];e[0]=l&65535;for(let w=1;w<8;w++)l=(e[w]+n[w]|0)+(l>>>16)|0,e[w]=l&65535}update(e){Pe(this);const{buffer:n,blockLen:r}=this;e=Me(e);const f=e.length;for(let c=0;c<f;){const l=Math.min(r-this.pos,f-c);if(l===r){for(;r<=f-c;c+=r)this.process(e,c);continue}if(n.set(e.subarray(c,c+l),this.pos),this.pos+=l,c+=l,this.pos===r)this.process(n,0,!1),this.pos=0}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Pe(this),In(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:f}=this;if(f){n[f++]=1;for(;f<16;f++)n[f]=0;this.process(n,0,!0)}this.finalize();let c=0;for(let l=0;l<8;l++)e[c++]=r[l]>>>0,e[c++]=r[l]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}var dc=Ol((e)=>new vc(e));function A(e,n){return e<<n|e>>>32-n}function Kr(e){return e.byteOffset%4===0}function Sl(e,n,r,f,c,l,w,$){const g=c.length,d=new Uint8Array(Bn),v=B(d),J=Kr(c)&&Kr(l),I=J?B(c):ic,E=J?B(l):ic;for(let i=0;i<g;w++){if(e(n,r,f,v,w,$),w>=Ic)throw new Error("arx: counter overflow");const q=Math.min(Bn,g-i);if(J&&q===Bn){const Q=i/4;if(i%4!==0)throw new Error("arx: invalid block position");for(let G=0,M;G<Hl;G++)M=Q+G,E[M]=I[M]^v[G];i+=Bn;continue}for(let Q=0,G;Q<q;Q++)G=i+Q,l[G]=c[G]^d[Q];i+=q}}function Pr(e,n){const{allowShortKeys:r,extendNonceFn:f,counterLength:c,counterRight:l,rounds:w}=kf({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},n);if(typeof e!=="function")throw new Error("core must be a function");return un(c),un(w),Ar(l),Ar(r),($,g,d,v,J=0)=>{C($),C(g),C(d);const I=d.length;if(!v)v=new Uint8Array(I);if(C(v),un(J),J<0||J>=Ic)throw new Error("arx: counter overflow");if(v.length<I)throw new Error(`arx: output (${v.length}) is shorter than data (${I})`);const E=[];let i=$.length,q,Q;if(i===32)q=$.slice(),E.push(q),Q=qc;else if(i===16&&r)q=new Uint8Array(32),q.set($),q.set($,16),Q=Dl,E.push(q);else throw new Error(`arx: invalid 32-byte key, got length=${i}`);if(!Kr(g))g=g.slice(),E.push(g);const G=B(q);if(f){if(g.length!==24)throw new Error("arx: extended nonce must be 24 bytes");f(Q,G,B(g.subarray(0,16)),G),g=g.subarray(16)}const M=16-c;if(M!==g.length)throw new Error(`arx: nonce must be ${M} or 16 bytes`);if(M!==12){const X=new Uint8Array(12);X.set(g,l?0:12-g.length),g=X,E.push(g)}const U=B(g);Sl(e,Q,G,U,d,v,J,w);while(E.length>0)E.pop().fill(0);return v}}var Jc=(e)=>Uint8Array.from(e.split("").map((n)=>n.charCodeAt(0))),Rl=Jc("expand 16-byte k"),Vl=Jc("expand 32-byte k"),Dl=B(Rl),qc=B(Vl),kg=qc.slice(),Bn=64,Hl=16,Ic=4294967295,ic=new Uint32Array;function Gc(e,n,r,f,c,l=20){let w=e[0],$=e[1],g=e[2],d=e[3],v=n[0],J=n[1],I=n[2],E=n[3],i=n[4],q=n[5],Q=n[6],G=n[7],M=c,U=r[0],X=r[1],N=r[2],W=w,Y=$,D=g,R=d,O=v,t=J,j=I,u=E,H=i,z=q,T=Q,Z=G,o=M,V=U,S=X,K=N;for(let y=0;y<l;y+=2)W=W+O|0,o=A(o^W,16),H=H+o|0,O=A(O^H,12),W=W+O|0,o=A(o^W,8),H=H+o|0,O=A(O^H,7),Y=Y+t|0,V=A(V^Y,16),z=z+V|0,t=A(t^z,12),Y=Y+t|0,V=A(V^Y,8),z=z+V|0,t=A(t^z,7),D=D+j|0,S=A(S^D,16),T=T+S|0,j=A(j^T,12),D=D+j|0,S=A(S^D,8),T=T+S|0,j=A(j^T,7),R=R+u|0,K=A(K^R,16),Z=Z+K|0,u=A(u^Z,12),R=R+u|0,K=A(K^R,8),Z=Z+K|0,u=A(u^Z,7),W=W+t|0,K=A(K^W,16),T=T+K|0,t=A(t^T,12),W=W+t|0,K=A(K^W,8),T=T+K|0,t=A(t^T,7),Y=Y+j|0,o=A(o^Y,16),Z=Z+o|0,j=A(j^Z,12),Y=Y+j|0,o=A(o^Y,8),Z=Z+o|0,j=A(j^Z,7),D=D+u|0,V=A(V^D,16),H=H+V|0,u=A(u^H,12),D=D+u|0,V=A(V^D,8),H=H+V|0,u=A(u^H,7),R=R+O|0,S=A(S^R,16),z=z+S|0,O=A(O^z,12),R=R+O|0,S=A(S^R,8),z=z+S|0,O=A(O^z,7);let P=0;f[P++]=w+W|0,f[P++]=$+Y|0,f[P++]=g+D|0,f[P++]=d+R|0,f[P++]=v+O|0,f[P++]=J+t|0,f[P++]=I+j|0,f[P++]=E+u|0,f[P++]=i+H|0,f[P++]=q+z|0,f[P++]=Q+T|0,f[P++]=G+Z|0,f[P++]=M+o|0,f[P++]=U+V|0,f[P++]=X+S|0,f[P++]=N+K|0}function tl(e,n,r,f){let c=e[0],l=e[1],w=e[2],$=e[3],g=n[0],d=n[1],v=n[2],J=n[3],I=n[4],E=n[5],i=n[6],q=n[7],Q=r[0],G=r[1],M=r[2],U=r[3];for(let N=0;N<20;N+=2)c=c+g|0,Q=A(Q^c,16),I=I+Q|0,g=A(g^I,12),c=c+g|0,Q=A(Q^c,8),I=I+Q|0,g=A(g^I,7),l=l+d|0,G=A(G^l,16),E=E+G|0,d=A(d^E,12),l=l+d|0,G=A(G^l,8),E=E+G|0,d=A(d^E,7),w=w+v|0,M=A(M^w,16),i=i+M|0,v=A(v^i,12),w=w+v|0,M=A(M^w,8),i=i+M|0,v=A(v^i,7),$=$+J|0,U=A(U^$,16),q=q+U|0,J=A(J^q,12),$=$+J|0,U=A(U^$,8),q=q+U|0,J=A(J^q,7),c=c+d|0,U=A(U^c,16),i=i+U|0,d=A(d^i,12),c=c+d|0,U=A(U^c,8),i=i+U|0,d=A(d^i,7),l=l+v|0,Q=A(Q^l,16),q=q+Q|0,v=A(v^q,12),l=l+v|0,Q=A(Q^l,8),q=q+Q|0,v=A(v^q,7),w=w+J|0,G=A(G^w,16),I=I+G|0,J=A(J^I,12),w=w+J|0,G=A(G^w,8),I=I+G|0,J=A(J^I,7),$=$+g|0,M=A(M^$,16),E=E+M|0,g=A(g^E,12),$=$+g|0,M=A(M^$,8),E=E+M|0,g=A(g^E,7);let X=0;f[X++]=c,f[X++]=l,f[X++]=w,f[X++]=$,f[X++]=Q,f[X++]=G,f[X++]=M,f[X++]=U}function Ec(e,n,r,f,c){const l=e(n,r,Kl),w=dc.create(l);if(c)Qc(w,c);Qc(w,f);const $=new Uint8Array(16),g=Ce($);se(g,0,BigInt(c?c.length:0),!0),se(g,8,BigInt(f.length),!0),w.update($);const d=w.digest();return l.fill(0),d}var mn=Pr(Gc,{counterRight:!1,counterLength:4,allowShortKeys:!1}),jl=Pr(Gc,{counterRight:!1,counterLength:8,extendNonceFn:tl,allowShortKeys:!1});var ul=new Uint8Array(16),Qc=(e,n)=>{e.update(n);const r=n.length%16;if(r)e.update(ul.subarray(r))},Kl=new Uint8Array(32),Mc=(e)=>(n,r,f)=>{return C(n,32),C(r),{encrypt:(l,w)=>{const $=l.length,g=$+16;if(w)C(w,g);else w=new Uint8Array(g);e(n,r,l,w,1);const d=Ec(e,n,r,w.subarray(0,-16),f);return w.set(d,$),w},decrypt:(l,w)=>{const $=l.length,g=$-16;if($<16)throw new Error("encrypted data must be at least 16 bytes");if(w)C(w,g);else w=new Uint8Array(g);const d=l.subarray(0,-16),v=l.subarray(-16),J=Ec(e,n,r,d,f);if(!ke(v,J))throw new Error("invalid tag");return e(n,r,d,w,1),w}}},rv=ze({blockSize:64,nonceLength:12,tagLength:16},Mc(mn)),Cr=ze({blockSize:64,nonceLength:24,tagLength:16},Mc(jl));class Br extends Jn{constructor(e,n){super();this.finished=!1,this.destroyed=!1,L.hash(e);const r=qe(n);if(this.iHash=e.create(),typeof this.iHash.update!=="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const f=this.blockLen,c=new Uint8Array(f);c.set(r.length>f?e.create().update(r).digest():r);for(let l=0;l<c.length;l++)c[l]^=54;this.iHash.update(c),this.oHash=e.create();for(let l=0;l<c.length;l++)c[l]^=106;this.oHash.update(c),c.fill(0)}update(e){return L.exists(this),this.iHash.update(e),this}digestInto(e){L.exists(this),L.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:f,destroyed:c,blockLen:l,outputLen:w}=this;return e=e,e.finished=f,e.destroyed=c,e.blockLen=l,e.outputLen=w,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}var Le=(e,n,r)=>new Br(e,n).update(r).digest();Le.create=(e,n)=>new Br(e,n);function oc(e,n,r){if(L.hash(e),r===void 0)r=new Uint8Array(e.outputLen);return Le(e,qe(r),qe(n))}function Uc(e,n,r,f=32){if(L.hash(e),L.number(f),f>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const c=Math.ceil(f/e.outputLen);if(r===void 0)r=zc;const l=new Uint8Array(c*e.outputLen),w=Le.create(e,n),$=w._cloneInto(),g=new Uint8Array(w.outputLen);for(let d=0;d<c;d++)mr[0]=d+1,$.update(d===0?zc:g).update(r).update(mr).digestInto(g),l.set(g,e.outputLen*d),w._cloneInto($);return w.destroy(),$.destroy(),g.fill(0),mr.fill(0),l.slice(0,f)}var mr=new Uint8Array([0]),zc=new Uint8Array;function pc(e,n){const r=Se.getSharedSecret(e,"02"+n).subarray(1,33);return oc(Ie,r,"nip44-v2")}function e0(e,n){const r=Uc(Ie,e,n,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function nf(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const n=1<<Math.floor(Math.log2(e-1))+1,r=n<=256?32:n/8;return r*(Math.floor((e-1)/r)+1)}function w8(e){if(!Number.isSafeInteger(e)||e<sc||e>xc)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const n=new Uint8Array(2);return new DataView(n.buffer).setUint16(0,e,!1),n}function $8(e){const n=Qe.encode(e),r=n.length,f=w8(r),c=new Uint8Array(nf(r)-r);return Ye(f,n,c)}function g8(e){const n=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+n);if(n<sc||n>xc||r.length!==n||e.length!==2+nf(n))throw new Error("invalid padding");return Xe.decode(r)}function n0(e,n,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const f=Ye(r,n);return Le(Ie,e,f)}function v8(e){if(typeof e!=="string")throw new Error("payload must be a valid string");const n=e.length;if(n<132||n>87472)throw new Error("invalid payload length: "+n);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=le.decode(e)}catch(l){throw new Error("invalid base64: "+l.message)}const f=r.length;if(f<99||f>65603)throw new Error("invalid data length: "+f);const c=r[0];if(c!==2)throw new Error("unknown encryption version "+c);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function r0(e,n,r=Fe(32)){const{chacha_key:f,chacha_nonce:c,hmac_key:l}=e0(n,r),w=$8(e),$=mn(f,c,w),g=n0(l,$,r);return le.encode(Ye(new Uint8Array([2]),r,$,g))}function f0(e,n){const{nonce:r,ciphertext:f,mac:c}=v8(e),{chacha_key:l,chacha_nonce:w,hmac_key:$}=e0(n,r),g=n0($,f,r);if(!ke(g,c))throw new Error("invalid MAC");const d=mn(l,w,f);return g8(d)}function J8(e){const{pathname:n,searchParams:r}=new URL(e),f=n,c=r.get("relay"),l=r.get("secret");if(!f||!c||!l)throw new Error("invalid connection string");return{pubkey:f,relay:c,secret:l}}async function q8(e,n,r){const f={method:"pay_invoice",params:{invoice:r}},c=await Lc(n,e,JSON.stringify(f)),l={kind:Kc,created_at:Math.round(Date.now()/1000),content:c,tags:[["p",e]]};return Ne(l,n)}function Q8(e){rf=e}async function E8(e){try{let n="",{lud06:r,lud16:f}=JSON.parse(e.content);if(r){let{words:w}=re.decode(r,1000),$=re.fromWords(w);n=Xe.decode($)}else if(f){let[w,$]=f.split("@");n=new URL(`/.well-known/lnurlp/${w}`,`https://${$}`).toString()}else return null;let l=await(await rf(n)).json();if(l.allowsNostr&&l.nostrPubkey)return l.callback}catch(n){}return null}function G8({profile:e,event:n,amount:r,relays:f,comment:c=""}){if(!r)throw new Error("amount not given");if(!e)throw new Error("profile not given");let l={kind:9734,created_at:Math.round(Date.now()/1000),content:c,tags:[["p",e],["amount",r.toString()],["relays",...f]]};if(n)l.tags.push(["e",n]);return l}function M8(e){let n;try{n=JSON.parse(e)}catch(l){return"Invalid zap request JSON."}if(!Xc(n))return"Zap request is not a valid Nostr event.";if(!_r(n))return"Invalid signature on zap request.";let r=n.tags.find(([l,w])=>l==="p"&&w);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let f=n.tags.find(([l,w])=>l==="e"&&w);if(f&&!f[1].match(/^[a-f0-9]{64}$/))return"Zap request 'e' tag is not valid hex.";if(!n.tags.find(([l,w])=>l==="relays"&&w))return"Zap request doesn't have a 'relays' tag.";return null}function z8({zapRequest:e,preimage:n,bolt11:r,paidAt:f}){let c=JSON.parse(e),l=c.tags.filter(([$])=>$==="e"||$==="p"||$==="a"),w={kind:9735,created_at:Math.round(f.getTime()/1000),content:"",tags:[...l,["P",c.pubkey],["bolt11",r],["description",e]]};if(n)w.tags.push(["preimage",n]);return w}async function U8(e,n,r,f=!1,c){const l={kind:hr,tags:[["u",e],["method",n]],created_at:Math.round(new Date().getTime()/1000),content:""};if(c)l.tags.push(["payload",ff(c)]);const w=await r(l);return(f?c0:"")+le.encode(Qe.encode(JSON.stringify(w)))}async function X8(e,n,r){const f=await l0(e).catch((l)=>{throw l});return await i0(f,n,r).catch((l)=>{throw l})}async function l0(e){if(!e)throw new Error("Missing token");e=e.replace(c0,"");const n=Xe.decode(le.decode(e));if(!n||n.length===0||!n.startsWith("{"))throw new Error("Invalid token");return JSON.parse(n)}function w0(e){if(!e.created_at)return!1;return Math.round(new Date().getTime()/1000)-e.created_at<60}function $0(e){return e.kind===hr}function g0(e,n){const r=e.tags.find((f)=>f[0]==="u");if(!r)return!1;return r.length>0&&r[1]===n}function v0(e,n){const r=e.tags.find((f)=>f[0]==="method");if(!r)return!1;return r.length>0&&r[1].toLowerCase()===n.toLowerCase()}function ff(e){const n=Ie(Qe.encode(JSON.stringify(e)));return k(n)}function d0(e,n){const r=e.tags.find((c)=>c[0]==="payload");if(!r)return!1;const f=ff(n);return r.length>0&&r[1]===f}async function i0(e,n,r,f){if(!_r(e))throw new Error("Invalid nostr event, signature invalid");if(!$0(e))throw new Error("Invalid nostr event, kind invalid");if(!w0(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!g0(e,n))throw new Error("Invalid nostr event, url tag invalid");if(!v0(e,r))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(f)&&typeof f==="object"&&Object.keys(f).length>0){if(!d0(e,f))throw new Error("Invalid nostr event, payload tag does not match request body hash")}return!0}var Pl=Object.defineProperty,a=(e,n)=>{for(var r in n)Pl(e,r,{get:n[r],enumerable:!0})},wn=Symbol("verified"),Cl=(e)=>e instanceof Object,Bl={};a(Bl,{Queue:()=>Wc,QueueNode:()=>Tc,binarySearch:()=>Lr,insertEventIntoAscendingList:()=>Ll,insertEventIntoDescendingList:()=>ml,normalizeURL:()=>Nc,utf8Decoder:()=>Xe,utf8Encoder:()=>Qe});var Xe=new TextDecoder("utf-8"),Qe=new TextEncoder,Tc=class{value;next=null;prev=null;constructor(e){this.value=e}},Wc=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const n=new Tc(e);if(!this.last)this.first=n,this.last=n;else if(this.last===this.first)this.last=n,this.last.prev=this.first,this.first.next=n;else n.prev=this.last,this.last.next=n,this.last=n;return!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const e=this.first;return this.first=e.next,e.value}},_l=class{generateSecretKey(){return nn.utils.randomPrivateKey()}getPublicKey(e){return k(nn.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=k(nn.getPublicKey(n)),r.id=_n(r),r.sig=k(nn.sign(_n(r),n)),r[wn]=!0,r}verifyEvent(e){if(typeof e[wn]==="boolean")return e[wn];const n=_n(e);if(n!==e.id)return e[wn]=!1,!1;try{const r=nn.verify(e.sig,n,e.pubkey);return e[wn]=r,r}catch(r){return e[wn]=!1,!1}}},an=new _l,Yc=an.generateSecretKey,Ac=an.getPublicKey,Ne=an.finalizeEvent,_r=an.verifyEvent,yl={};a(yl,{Application:()=>yw,BadgeAward:()=>nw,BadgeDefinition:()=>Pw,BlockedRelaysList:()=>Tw,BookmarkList:()=>Uw,Bookmarksets:()=>jw,Calendar:()=>pw,CalendarEventRSVP:()=>e$,ChannelCreation:()=>Dc,ChannelHideMessage:()=>tc,ChannelMessage:()=>Sc,ChannelMetadata:()=>Hc,ChannelMuteUser:()=>jc,ClassifiedListing:()=>Fw,ClientAuth:()=>uc,CommunitiesList:()=>Xw,CommunityDefinition:()=>f$,CommunityPostApproval:()=>dw,Contacts:()=>sl,CreateOrUpdateProduct:()=>mw,CreateOrUpdateStall:()=>Bw,Curationsets:()=>uw,Date:()=>sw,DraftClassifiedListing:()=>kw,DraftLong:()=>_w,Emojisets:()=>aw,EncryptedDirectMessage:()=>xl,EncryptedDirectMessages:()=>pl,EventDeletion:()=>ew,FileMetadata:()=>cw,FileServerPreference:()=>Zw,Followsets:()=>Hw,GenericRepost:()=>rw,Genericlists:()=>Sw,HTTPAuth:()=>hr,Handlerinformation:()=>r$,Handlerrecommendation:()=>n$,Highlights:()=>Gw,InterestsList:()=>Yw,Interestsets:()=>Cw,JobFeedback:()=>qw,JobRequest:()=>iw,JobResult:()=>Jw,Label:()=>vw,LightningPubRPC:()=>Rw,LiveChatMessage:()=>lw,LiveEvent:()=>hw,LongFormArticle:()=>Lw,Metadata:()=>bl,Mutelist:()=>Mw,NWCWalletInfo:()=>Ow,NWCWalletRequest:()=>Kc,NWCWalletResponse:()=>Vw,NostrConnect:()=>Dw,OpenTimestamps:()=>fw,Pinlist:()=>zw,ProblemTracker:()=>ww,ProfileBadges:()=>Kw,PublicChatsList:()=>Nw,Reaction:()=>yr,RecommendRelay:()=>kl,RelayList:()=>ow,Relaysets:()=>tw,Report:()=>$w,Reporting:()=>gw,Repost:()=>ar,SearchRelaysList:()=>Ww,ShortTextNote:()=>Fl,Time:()=>xw,UserEmojiList:()=>Aw,UserStatuses:()=>bw,Zap:()=>Ew,ZapGoal:()=>Iw,ZapRequest:()=>Qw,classifyKind:()=>hl,isEphemeralKind:()=>Rc,isParameterizedReplaceableKind:()=>Vc,isRegularKind:()=>Zc,isReplaceableKind:()=>Oc});var bl=0,Fl=1,kl=2,sl=3,xl=4,pl=4,ew=5,ar=6,yr=7,nw=8,rw=16,Dc=40,Hc=41,Sc=42,tc=43,jc=44,fw=1040,cw=1063,lw=1311,ww=1971,$w=1984,gw=1984,vw=1985,dw=4550,iw=5999,Jw=6999,qw=7000,Iw=9041,Qw=9734,Ew=9735,Gw=9802,Mw=1e4,zw=10001,ow=10002,Uw=10003,Xw=10004,Nw=10005,Tw=10006,Ww=10007,Yw=10015,Aw=10030,Zw=10096,Ow=13194,Rw=21000,uc=22242,Kc=23194,Vw=23195,Dw=24133,hr=27235,Hw=30000,Sw=30001,tw=30002,jw=30003,uw=30004,Kw=30008,Pw=30009,Cw=30015,Bw=30017,mw=30018,Lw=30023,_w=30024,aw=30030,yw=30078,hw=30311,bw=30315,Fw=30402,kw=30403,sw=31922,xw=31923,pw=31924,e$=31925,n$=31989,r$=31990,f$=34550,w$={};a(w$,{getHex64:()=>yn,getInt:()=>Pc,getSubscriptionId:()=>Cc,matchEventId:()=>$$,matchEventKind:()=>v$,matchEventPubkey:()=>g$});var d$={};a(d$,{makeAuthEvent:()=>Bc});var J$=class{url;_connected=!1;onclose=null;onnotice=(e)=>console.debug(`NOTICE from ${this.url}: ${e}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Wc;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,n){this.url=Nc(e),this.verifyEvent=n.verifyEvent,this._WebSocket=n.websocketImplementation||WebSocket}static async connect(e,n){const r=new J$(e,n);return await r.connect(),r}closeAllSubscriptions(e){for(let[n,r]of this.openSubs)r.close(e);this.openSubs.clear();for(let[n,r]of this.openEventPublishes)r.reject(new Error(e));this.openEventPublishes.clear();for(let[n,r]of this.openCountRequests)r.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){if(this.connectionPromise)return this.connectionPromise;return this.challenge=void 0,this.connectionPromise=new Promise((e,n)=>{this.connectionTimeoutHandle=setTimeout(()=>{n("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(r){n(r);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=(r)=>{if(n(r.message||"websocket error"),this._connected)this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored")},this.ws.onclose=async()=>{if(this._connected)this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise}async runQueue(){this.queueRunning=!0;while(!0){if(this.handleNext()===!1)break;await i$()}this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const n=Cc(e);if(n){const r=this.openSubs.get(n);if(!r)return;const f=yn(e,"id"),c=r.alreadyHaveEvent?.(f);if(r.receivedEvent?.(this,f),c)return}try{let r=JSON.parse(e);switch(r[0]){case"EVENT":{const f=this.openSubs.get(r[1]),c=r[2];if(this.verifyEvent(c)&&l$(f.filters,c))f.onevent(c);return}case"COUNT":{const f=r[1],c=r[2],l=this.openCountRequests.get(f);if(l)l.resolve(c.count),this.openCountRequests.delete(f);return}case"EOSE":{const f=this.openSubs.get(r[1]);if(!f)return;f.receivedEose();return}case"OK":{const f=r[1],c=r[2],l=r[3],w=this.openEventPublishes.get(f);if(c)w.resolve(l);else w.reject(new Error(l));this.openEventPublishes.delete(f);return}case"CLOSED":{const f=r[1],c=this.openSubs.get(f);if(!c)return;c.closed=!0,c.close(r[2]);return}case"NOTICE":this.onnotice(r[1]);return;case"AUTH":{this.challenge=r[1],this._onauth?.(r[1]);return}}}catch(r){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const n=await e(Bc(this.url,this.challenge)),r=new Promise((f,c)=>{this.openEventPublishes.set(n.id,{resolve:f,reject:c})});return this.send('["AUTH",'+JSON.stringify(n)+"]"),r}async publish(e){const n=new Promise((r,f)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:f})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),n}async count(e,n){this.serial++;const r=n?.id||"count:"+this.serial,f=new Promise((c,l)=>{this.openCountRequests.set(r,{resolve:c,reject:l})});return this.send('["COUNT","'+r+'",'+JSON.stringify(e).substring(1)),f}subscribe(e,n){const r=this.prepareSubscription(e,n);return r.fire(),r}prepareSubscription(e,n){this.serial++;const r=n.id||"sub:"+this.serial,f=new q$(this,r,e,n);return this.openSubs.set(r,f),f}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){if(this.incomingMessageQueue.enqueue(e.data),!this.queueRunning)this.runQueue()}},q$=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,n,r,f){this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=f.alreadyHaveEvent,this.receivedEvent=f.receivedEvent,this.eoseTimeout=f.eoseTimeout||e.baseEoseTimeout,this.oneose=f.oneose,this.onclose=f.onclose,this.onevent=f.onevent||((c)=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,c)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){if(this.eosed)return;clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.()}close(e="closed by caller"){if(!this.closed&&this.relay.connected)this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0;this.relay.openSubs.delete(this.id),this.onclose?.(e)}},I$;try{I$=WebSocket}catch{}var Q$;try{Q$=WebSocket}catch{}var br={};a(br,{BECH32_REGEX:()=>mc,Bech32MaxSize:()=>Fr,decode:()=>hn,encodeBytes:()=>bn,naddrEncode:()=>X$,neventEncode:()=>U$,noteEncode:()=>z$,nprofileEncode:()=>o$,npubEncode:()=>M$,nrelayEncode:()=>N$,nsecEncode:()=>G$});var Fr=5000,mc=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;var kr={};a(kr,{decrypt:()=>T$,encrypt:()=>Lc});var W$={};a(W$,{NIP05_REGEX:()=>ac,isValid:()=>Z$,queryProfile:()=>yc,searchDomain:()=>A$,useFetchImplementation:()=>Y$});var ac=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,kn;try{kn=fetch}catch{}var O$={};a(O$,{parse:()=>R$});var V$={};a(V$,{fetchRelayInformation:()=>H$,useFetchImplementation:()=>D$});var hc;try{hc=fetch}catch{}var S$={};a(S$,{getPow:()=>bc,minePow:()=>t$});var j$={};a(j$,{finishRepostEvent:()=>u$,getRepostedEvent:()=>K$,getRepostedEventPointer:()=>Fc});var P$={};a(P$,{NOSTR_URI_REGEX:()=>sn,parse:()=>B$,test:()=>C$});var sn=new RegExp(`nostr:(${mc.source})`),m$={};a(m$,{finishReactionEvent:()=>L$,getReactedEventPointer:()=>_$});var a$={};a(a$,{matchAll:()=>y$,regex:()=>sr,replaceAll:()=>h$});var sr=()=>new RegExp(`\\b${sn.source}\\b`,"g"),b$={};a(b$,{channelCreateEvent:()=>F$,channelHideMessageEvent:()=>x$,channelMessageEvent:()=>s$,channelMetadataEvent:()=>k$,channelMuteUserEvent:()=>p$});var F$=(e,n)=>{let r;if(typeof e.content==="object")r=JSON.stringify(e.content);else if(typeof e.content==="string")r=e.content;else return;return Ne({kind:Dc,tags:[...e.tags??[]],content:r,created_at:e.created_at},n)},k$=(e,n)=>{let r;if(typeof e.content==="object")r=JSON.stringify(e.content);else if(typeof e.content==="string")r=e.content;else return;return Ne({kind:Hc,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},s$=(e,n)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];if(e.reply_to_channel_message_event_id)r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]);return Ne({kind:Sc,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},n)},x$=(e,n)=>{let r;if(typeof e.content==="object")r=JSON.stringify(e.content);else if(typeof e.content==="string")r=e.content;else return;return Ne({kind:tc,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},n)},p$=(e,n)=>{let r;if(typeof e.content==="object")r=JSON.stringify(e.content);else if(typeof e.content==="string")r=e.content;else return;return Ne({kind:jc,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},n)},e8={};a(e8,{EMOJI_SHORTCODE_REGEX:()=>kc,matchAll:()=>n8,regex:()=>xr,replaceAll:()=>r8});var kc=/:(\w+):/,xr=()=>new RegExp(`\\B${kc.source}\\B`,"g"),f8={};a(f8,{useFetchImplementation:()=>c8,validateGithub:()=>l8});var pr;try{pr=fetch}catch{}var ef={};a(ef,{decrypt:()=>f0,encrypt:()=>r0,getConversationKey:()=>pc,v2:()=>d8});var sc=1,xc=65535,d8={utils:{getConversationKey:pc,calcPaddedLen:nf},encrypt:r0,decrypt:f0},i8={};a(i8,{makeNwcRequestEvent:()=>q8,parseConnectionString:()=>J8});var I8={};a(I8,{getZapEndpoint:()=>E8,makeZapReceipt:()=>z8,makeZapRequest:()=>G8,useFetchImplementation:()=>Q8,validateZapRequest:()=>M8});var rf;try{rf=fetch}catch{}var o8={};a(o8,{getToken:()=>U8,hashPayload:()=>ff,unpackEventFromToken:()=>l0,validateEvent:()=>i0,validateEventKind:()=>$0,validateEventMethodTag:()=>v0,validateEventPayloadTag:()=>d0,validateEventTimestamp:()=>w0,validateEventUrlTag:()=>g0,validateToken:()=>X8});var c0="Nostr ";var $f={};Jf($f,{encrypt:()=>R8,decrypt:()=>V8});function T8(e,n,r,f){L.hash(e);const c=Sn({dkLen:32,asyncTick:10},f),{c:l,dkLen:w,asyncTick:$}=c;if(L.number(l),L.number(w),L.number($),l<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const g=qe(n),d=qe(r),v=new Uint8Array(w),J=Le.create(e,g),I=J._cloneInto().update(d);return{c:l,dkLen:w,asyncTick:$,DK:v,PRF:J,PRFSalt:I}}function W8(e,n,r,f,c){if(e.destroy(),n.destroy(),f)f.destroy();return c.fill(0),r}function cf(e,n,r,f){const{c,dkLen:l,DK:w,PRF:$,PRFSalt:g}=T8(e,n,r,f);let d;const v=new Uint8Array(4),J=rn(v),I=new Uint8Array($.outputLen);for(let E=1,i=0;i<l;E++,i+=$.outputLen){const q=w.subarray(i,i+$.outputLen);J.setInt32(0,E,!1),(d=g._cloneInto(d)).update(v).digestInto(I),q.set(I.subarray(0,q.length));for(let Q=1;Q<c;Q++){$._cloneInto(d).update(I).digestInto(I);for(let G=0;G<q.length;G++)q[G]^=I[G]}}return W8($,g,w,d,I)}function J0(e,n,r,f,c,l){let w=e[n++]^r[f++],$=e[n++]^r[f++],g=e[n++]^r[f++],d=e[n++]^r[f++],v=e[n++]^r[f++],J=e[n++]^r[f++],I=e[n++]^r[f++],E=e[n++]^r[f++],i=e[n++]^r[f++],q=e[n++]^r[f++],Q=e[n++]^r[f++],G=e[n++]^r[f++],M=e[n++]^r[f++],U=e[n++]^r[f++],X=e[n++]^r[f++],N=e[n++]^r[f++],W=w,Y=$,D=g,R=d,O=v,t=J,j=I,u=E,H=i,z=q,T=Q,Z=G,o=M,V=U,S=X,K=N;for(let P=0;P<8;P+=2)O^=m(W+o|0,7),H^=m(O+W|0,9),o^=m(H+O|0,13),W^=m(o+H|0,18),z^=m(t+Y|0,7),V^=m(z+t|0,9),Y^=m(V+z|0,13),t^=m(Y+V|0,18),S^=m(T+j|0,7),D^=m(S+T|0,9),j^=m(D+S|0,13),T^=m(j+D|0,18),R^=m(K+Z|0,7),u^=m(R+K|0,9),Z^=m(u+R|0,13),K^=m(Z+u|0,18),Y^=m(W+R|0,7),D^=m(Y+W|0,9),R^=m(D+Y|0,13),W^=m(R+D|0,18),j^=m(t+O|0,7),u^=m(j+t|0,9),O^=m(u+j|0,13),t^=m(O+u|0,18),Z^=m(T+z|0,7),H^=m(Z+T|0,9),z^=m(H+Z|0,13),T^=m(z+H|0,18),o^=m(K+S|0,7),V^=m(o+K|0,9),S^=m(V+o|0,13),K^=m(S+V|0,18);c[l++]=w+W|0,c[l++]=$+Y|0,c[l++]=g+D|0,c[l++]=d+R|0,c[l++]=v+O|0,c[l++]=J+t|0,c[l++]=I+j|0,c[l++]=E+u|0,c[l++]=i+H|0,c[l++]=q+z|0,c[l++]=Q+T|0,c[l++]=G+Z|0,c[l++]=M+o|0,c[l++]=U+V|0,c[l++]=X+S|0,c[l++]=N+K|0}function lf(e,n,r,f,c){let l=f+0,w=f+16*c;for(let $=0;$<16;$++)r[w+$]=e[n+(2*c-1)*16+$];for(let $=0;$<c;$++,l+=16,n+=16){if(J0(r,w,e,n,r,l),$>0)w+=16;J0(r,l,e,n+=16,r,w)}}function Y8(e,n,r){const f=Sn({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:c,r:l,p:w,dkLen:$,asyncTick:g,maxmem:d,onProgress:v}=f;if(L.number(c),L.number(l),L.number(w),L.number($),L.number(g),L.number(d),v!==void 0&&typeof v!=="function")throw new Error("progressCb should be function");const J=128*l,I=J/4;if(c<=1||(c&c-1)!==0||c>=2**(J/8)||c>4294967296)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(w<0||w>137438953440/J)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if($<0||$>137438953440)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const E=J*(c+w);if(E>d)throw new Error(`Scrypt: parameters too large, ${E} (128 * r * (N + p)) > ${d} (maxmem)`);const i=cf(Ie,e,n,{c:1,dkLen:J*w}),q=Hn(i),Q=Hn(new Uint8Array(J*c)),G=Hn(new Uint8Array(J));let M=()=>{};if(v){const U=2*c*w,X=Math.max(Math.floor(U/1e4),1);let N=0;M=()=>{if(N++,v&&(!(N%X)||N===U))v(N/U)}}return{N:c,r:l,p:w,dkLen:$,blockSize32:I,V:Q,B32:q,B:i,tmp:G,blockMixCb:M,asyncTick:g}}function A8(e,n,r,f,c){const l=cf(Ie,e,r,{c:1,dkLen:n});return r.fill(0),f.fill(0),c.fill(0),l}function wf(e,n,r){const{N:f,r:c,p:l,dkLen:w,blockSize32:$,V:g,B32:d,B:v,tmp:J,blockMixCb:I}=Y8(e,n,r);for(let E=0;E<l;E++){const i=$*E;for(let q=0;q<$;q++)g[q]=d[i+q];for(let q=0,Q=0;q<f-1;q++)lf(g,Q,g,Q+=$,c),I();lf(g,(f-1)*$,d,i,c),I();for(let q=0;q<f;q++){const Q=d[i+$-16]%f;for(let G=0;G<$;G++)J[G]=d[i+G]^g[Q*$+G];lf(J,0,d,i,c),I()}}return A8(e,w,v,g,J)}var m=(e,n)=>e<<n|e>>>32-n;function Z8(e,n){let r=re.toWords(n);return re.encode(e,r,q0)}function O8(e,n){return Z8(e,n)}function R8(e,n,r=16,f=2){let c=Fe(16),l=2**r,w=wf(n.normalize("NFKC"),c,{N:l,r:8,p:1,dkLen:32}),$=Fe(24),g=Uint8Array.from([f]),v=Cr(w,$,g).encrypt(e),J=Ye(Uint8Array.from([2]),Uint8Array.from([r]),c,$,g,v);return O8("ncryptsec",J)}function V8(e,n){let{prefix:r,words:f}=re.decode(e,q0);if(r!=="ncryptsec")throw new Error(`invalid prefix ${r}, expected 'ncryptsec'`);let c=new Uint8Array(re.fromWords(f)),l=c[0];if(l!==2)throw new Error(`invalid version ${l}, expected 0x02`);let $=2**c[1],g=c.slice(2,18),d=c.slice(18,42),v=c[42],J=Uint8Array.from([v]),I=c.slice(43),E=wf(n.normalize("NFKC"),g,{N:$,r:8,p:1,dkLen:32});return Cr(E,d,J).decrypt(I)}var q0=5000;window.NostrIdentitySDK={nip19:br,nip44:ef,nip04:kr,generateSecretKey:Yc,getPublicKey:Ac,nip49:$f,finalizeEvent:Ne};
